<!DOCTYPE html>
<html lang="ko">
<head>
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2c3e50">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFC ì‚¬ë¬´ì‹¤ í˜„í™© ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê³µí†µ ë³€ìˆ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        :root {
            --font-primary: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

            /* ìƒ‰ìƒ íŒ”ë ˆíŠ¸ */
            --sidebar-bg: #2c3e50;
            --sidebar-header-bg: #34495e;
            --sidebar-text: #ecf0f1;
            --sidebar-accent: #3498db;
            --main-bg: #f4f6f9;
            --content-bg: #ffffff;
            --text-primary: #343a40;
            --text-secondary: #6c757d;
            --border-color: #e9ecef;
            --accent-green: #28a745;
            --accent-yellow: #ffc107; /* ê²½ê³ ìƒ‰ (ì˜ˆ: 6ê°œì›” ì´ë‚´ ë§Œë£Œ) */
            --accent-red: #e74c3c;   /* ìœ„í—˜ìƒ‰ (ì˜ˆ: 2ê°œì›” ì´ë‚´ ë§Œë£Œ) */
            --accent-blue: #007bff;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --border-radius: 8px;
            /* ì„ë°• ë°°ê²½ìƒ‰ */
            --danger-bg: #ffcdd2;   /* 2ê°œì›” ì´ë‚´ í…Œì´ë¸” í–‰ ë°°ê²½ */
            --warning-bg: #ffe0b2;  /* 6ê°œì›” ì´ë‚´ í…Œì´ë¸” í–‰ ë°°ê²½ (í˜„ì¬ëŠ” --safe-bg ì‚¬ìš© ì¤‘, í•„ìš”ì‹œ êµì²´) */
            --safe-bg: #e8f5e8;     /* 6ê°œì›” ì´ˆê³¼ ë˜ëŠ” ì•ˆì „ ìƒíƒœ ë°°ê²½ */
        }

        * {
            margin: 0; padding: 0; box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--main-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì‚¬ì´ë“œë°” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .sidebar {
            width: 270px;
            background: var(--sidebar-bg);
            color: var(--sidebar-text);
            box-shadow: var(--shadow-md);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1100;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: var(--sidebar-header-bg);
            border-bottom: 1px solid #405060;
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }

        .sidebar-subtitle {
            font-size: 0.85rem;
            color: #bdc3c7;
            font-weight: 300;
        }

        .nav-menu {
            padding: 15px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            color: var(--sidebar-text);
            text-decoration: none;
            transition: all 0.25s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 0.95rem;
            font-weight: 600;
            border-left: 4px solid transparent;
        }

        .nav-item:hover {
            background: var(--sidebar-header-bg);
            border-left-color: var(--sidebar-accent);
            color: #fff;
        }

        .nav-item.active {
            background: var(--sidebar-header-bg);
            border-left-color: var(--sidebar-accent);
            color: var(--sidebar-accent);
            font-weight: 700;
        }

        .nav-item .icon {
            margin-right: 15px;
            font-size: 1rem;
            width: 22px;
            text-align: center;
            color: #95a5a6;
        }
        .nav-item:hover .icon,
        .nav-item.active .icon {
            color: var(--sidebar-accent);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì‚¬ì´ë“œë°” í•˜ë‹¨: ê³„ì•½ ë§Œë£Œ ì„ë°• í˜„í™© ì¹´ë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .sidebar-alert-wrapper {
            padding: 15px;
            margin-top: auto; /* í‘¸ì‹œ íˆ¬ ë°”í…€ */
        }

        .alert-card {
            background: var(--sidebar-header-bg); /* ì¢€ ë” ë¶€ë“œëŸ¬ìš´ ë°°ê²½ */
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            color: #fff;
            overflow: hidden;
        }

        .alert-card-header {
            background: #d32f2f; /* ìœ„í—˜ ê°•ì¡° */
            padding: 10px 15px;
            font-size: 1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
        }
        .alert-card-header i {
            margin-right: 8px;
            font-size: 1.1rem;
        }

        .alert-card-body {
            padding: 12px 15px;
            max-height: 350px; /* í•„ìš”ì‹œ ìŠ¤í¬ë¡¤ (ê¸°ì¡´ 200pxì—ì„œ 350pxë¡œ ìˆ˜ì •) */
            overflow-y: auto;
        }

        .alert-period {
            background: rgba(255,255,255,0.1);
            color: var(--sidebar-text);
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .alert-period i {
            margin-right: 6px;
        }

        .alert-item {
            color: var(--text-primary); /* ë‚´ë¶€ í…ìŠ¤íŠ¸ëŠ” ë°ì€ ë°°ê²½ì— ë§ê²Œ */
            padding: 7px 10px;
            border-radius: 6px;
            font-size: 0.85rem; /* ì•½ê°„ ì‘ê²Œ */
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            transition: background-color 0.2s ease;
        }
        .alert-item:last-child { margin-bottom: 0; }

        .alert-item.critical { /* 2ê°œì›” ì´ë‚´ */
            background: var(--danger-bg); /* ë°ì€ ë¹¨ê°• */
            color: #7f1d1d; /* ì–´ë‘ìš´ ë¹¨ê°• í…ìŠ¤íŠ¸ */
            font-weight: bold;
        }
        .alert-item.warning { /* 6ê°œì›” ì´ë‚´ */
            background: var(--warning-bg); /* ë°ì€ ì£¼í™© */
            color: #7c2d12; /* ì–´ë‘ìš´ ì£¼í™© í…ìŠ¤íŠ¸ */
        }
         .alert-item:hover {
            filter: brightness(0.95);
        }


        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë©”ì¸ ì»¨í…ì¸  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .main-content {
            flex: 1;
            margin-left: 270px;
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s ease-in-out;
        }
        .overlay { /* ëª¨ë°”ì¼ ë©”ë‰´ í™œì„± ì‹œ ë°°ê²½ */
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1090; /* ì‚¬ì´ë“œë°” ë°”ë¡œ ì•„ë˜ */
        }
        .overlay.active { display: block; }


        .main-header {
            background: var(--content-bg);
            padding: 18px 30px;
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.6rem;
            color: var(--text-primary);
            cursor: pointer;
            margin-right: 20px;
            padding: 5px;
        }

        .main-title-container { flex-grow: 1; }
        .main-title {
            font-size: 1.7rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        .main-breadcrumb {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 400;
        }

        .content-area {
            flex: 1;
            padding: 30px;
            background: var(--main-bg);
        }

        .notice {
            padding: 18px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            font-size: 0.95rem;
            font-weight: 500;
            border: 1px solid transparent;
        }
        .notice-info { background: #e0f3f8; border-color: #bee5eb; color: #0c5460; }
        .notice-warning { background: #fff8e1; border-color: #ffeeba; color: #856404; }
        .notice-success { background: #e6f5e9; border-color: #c3e6cb; color: #155724; }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í•„í„° ì»¨í…Œì´ë„ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .filters-container {
            margin-bottom: 20px;
            background: var(--content-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            align-items: flex-end; /* ë²„íŠ¼ ë†’ì´ ë§ì¶¤ */
        }

        .filters-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .filters-container .setup-input, 
        .filters-container .filter-button,
        .column-toggle-btn { /* ê³µí†µ ìŠ¤íƒ€ì¼ */
            width: 100%; /* ë²„íŠ¼ë„ width 100% */
            padding: 10px 14px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .filters-container .setup-input { background: #fafafa; }
        .filters-container .setup-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            background: #fff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.2);
        }

        .filters-container .filter-button {
            font-weight: 600;
            cursor: pointer;
            background: var(--accent-red);
            color: #fff;
            border: none; /* ì¤‘ë³µ ì œê±° */
        }
        .filters-container .filter-button:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }


        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° í…Œì´ë¸” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .data-table-container {
            background: var(--content-bg);
            border-radius: var(--border-radius);
            padding: 0; /* í…Œì´ë¸” ìì²´ íŒ¨ë”©ìœ¼ë¡œ ëŒ€ì²´ */
            box-shadow: var(--shadow-md);
            overflow-x: auto;
            position: relative;
            width: 100%;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px; 
        }
        .data-table th, .data-table td {
            padding: 14px 18px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            max-width: 150px; 
            text-align: center; /* ê¸°ë³¸ ì¤‘ì•™ ì •ë ¬ */
        }
        .data-table th {
            background-color: #f8f9fa;
            font-weight: 700;
            color: var(--text-primary);
            position: sticky; /* í—¤ë” ê³ ì • */
            top: 0;
            z-index: 10;
        }
        .data-table td.remarks-cell { /* ë¹„ê³  ì…€ë§Œ ì¢Œì¸¡ ì •ë ¬ ë° ì¤„ë°”ê¿ˆ */
            text-align: left;
            max-width: 200px;
            white-space: normal; 
            word-wrap: break-word;
        }
        .data-table tbody tr {
            cursor: pointer;
            transition: all 0.15s ease;
        }
        .data-table tbody tr:nth-child(odd) { background-color: var(--content-bg); }
        .data-table tbody tr:nth-child(even) { background-color: #fdfdfd; }
        .data-table tbody tr:hover {
            background-color: #e9ecef !important; /* í˜¸ë²„ ì‹œ ë°°ê²½ìƒ‰ ìš°ì„  ì ìš© */
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* ë§Œë£Œ ì„ë°• í–‰ ê°•ì¡°ëŠ” JSì—ì„œ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ ì§ì ‘ ì ìš© ì¤‘, í•„ìš”ì‹œ CSS í´ë˜ìŠ¤ë¡œ ì „í™˜ ê°€ëŠ¥ */

        .sortable-header {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 25px !important; /* ì•„ì´ì½˜ ê³µê°„ í™•ë³´ */
        }
        .sortable-header:hover { background-color: #e9ecef; }
        .sort-icon {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
            font-size: 0.8rem;
        }
        .sortable-header.sort-asc .sort-icon,
        .sortable-header.sort-desc .sort-icon {
            opacity: 1;
            color: var(--accent-blue);
        }
        /* .sortable-header.sort-desc .sort-icon { transform: translateY(-50%) rotate(180deg); }  JSì—ì„œ ì•„ì´ì½˜ ì§ì ‘ ë³€ê²½ */


        /* ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ */
        .theme-toggle {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .theme-toggle:hover {
            background-color: var(--sidebar-accent);
            color: white;
            border-color: var(--sidebar-accent);
        }

        /* ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        body.dark-mode {
            --main-bg: #1a1a1a;
            --content-bg: #2d2d2d;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --border-color: #404040;
            --sidebar-bg: #1e1e1e;
            --sidebar-header-bg: #252525;
            --sidebar-text: #e0e0e0;
            --danger-bg: #5c2329;  /* ë‹¤í¬ëª¨ë“œìš© ì„ë°• ë°°ê²½ */
            --warning-bg: #5a3d15; /* ë‹¤í¬ëª¨ë“œìš© ê²½ê³  ë°°ê²½ */
            --safe-bg: #223d22;    /* ë‹¤í¬ëª¨ë“œìš© ì•ˆì „ ë°°ê²½ */
        }
        body.dark-mode .data-table th,
        body.dark-mode .stats-detail-table th { background-color: #404040; color: var(--text-primary); }
        body.dark-mode .data-table tbody tr:nth-child(even),
        body.dark-mode .stats-detail-table tbody tr:nth-child(even) { background-color: #353535; }
        body.dark-mode .data-table tbody tr:hover,
        body.dark-mode .stats-detail-table tbody tr:hover { background-color: #454545 !important; }
        body.dark-mode .filters-container .setup-input {
            background: #404040;
            border-color: #555;
            color: var(--text-primary);
        }
        body.dark-mode .filters-container .setup-input:focus {
            background: #4a4a4a;
            border-color: var(--sidebar-accent);
        }
        body.dark-mode .notice-info { background: #2a3f4f; border-color: #3a5f7f; color: #a0c4e4; }
        body.dark-mode .notice-success { background: #1f3f2f; border-color: #2f5f3f; color: #a0e4a0; }
        body.dark-mode .notice-warning { background: #4f3f1f; border-color: #7f5f2f; color: #e4c4a0; }

        body.dark-mode .alert-card { background: var(--sidebar-header-bg); }
        body.dark-mode .alert-period { background: rgba(255,255,255,0.05); color: var(--sidebar-text); }
        body.dark-mode .alert-item.critical { background: var(--danger-bg); color: #f8c8cb; }
        body.dark-mode .alert-item.warning { background: var(--warning-bg); color: #ffdca9; }
        body.dark-mode .metric-item { background: #3a3a3a; border-color: #4a4a4a; }
        body.dark-mode .tab-link { background: #2d2d2d; color: var(--text-secondary); }
        body.dark-mode .tab-link.active { background: var(--content-bg); border-color: #404040; color: var(--text-primary); }
        body.dark-mode .tab-content { border-color: #404040; }
        body.dark-mode .stats-summary-row.expanded { background-color: #4a4a4a; }
        body.dark-mode .stats-detail-content { background-color: #262626; }
        body.dark-mode .stats-sub-table th { background-color: #3a3a3a; }
        body.dark-mode .stats-summary-row:hover { background-color: #3f3f3f; }


        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .autocomplete-container { position: relative; width: 100%; }
        .autocomplete-dropdown {
            position: absolute;
            top: 100%; left: 0; right: 0;
            background: var(--content-bg);
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 6px 6px;
            box-shadow: var(--shadow-md);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        .autocomplete-item {
            padding: 10px 14px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            transition: background-color 0.2s ease;
        }
        .autocomplete-item:last-child { border-bottom: none; }
        .autocomplete-item:hover, .autocomplete-item.selected {
            background-color: var(--sidebar-accent);
            color: white;
        }
        .autocomplete-item .match { font-weight: 700; /* color: var(--sidebar-accent); // í˜¸ë²„ ì‹œ í°ìƒ‰ìœ¼ë¡œ ë°”ë€œ */ }
        /* .autocomplete-item:hover .match, .autocomplete-item.selected .match { color: white; } */


        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì»¬ëŸ¼ í† ê¸€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .column-toggle-container { position: relative; }
        .column-toggle-btn { /* ìŠ¤íƒ€ì¼ì€ .setup-inputê³¼ ìœ ì‚¬í•˜ê²Œ */
            background: var(--content-bg);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .column-toggle-btn:hover {
            border-color: var(--sidebar-accent);
            background-color: var(--sidebar-accent);
            color: white;
        }
        .column-toggle-dropdown {
            position: absolute;
            top: 100%; left: 0; /* ì˜¤ë¥¸ìª½ ì •ë ¬ í•„ìš”ì‹œ right: 0; left: auto; */
            background: var(--content-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: var(--shadow-md);
            padding: 10px;
            min-width: 200px;
            z-index: 1000;
            display: none;
        }
        .column-toggle-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            font-size: 0.9rem;
        }
        .column-toggle-item input[type="checkbox"] { width: 16px; height: 16px; cursor: pointer; }
        .column-toggle-item label { font-weight: normal; margin-bottom: 0; cursor: pointer;}


        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ìš”ì•½ ì¹´ë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .filter-summary-card {
            background: var(--content-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 15px 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--sidebar-accent);
            display: none; /* JSë¡œ .show ì¶”ê°€ ì‹œ ë³´ì„ */
        }
        .filter-summary-card.show { display: block; animation: fadeInUp 0.3s ease-out; }
        .summary-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }
        .summary-stat { text-align: center; }
        .summary-stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--sidebar-accent);
            display: block;
        }
        .summary-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© */
        .skeleton-table { width: 100%; border-collapse: collapse; min-width: 800px; }
        .skeleton-table th, .skeleton-table td { padding: 14px 18px; border-bottom: 1px solid var(--border-color); }
        .skeleton-table th { background-color: #f8f9fa; text-align: center; }
        .skeleton-item {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
            height: 16px; width: 100%;
        }
        .skeleton-item.short { width: 60%; }
        .skeleton-item.medium { width: 80%; }
        .skeleton-item.badge { width: 50px; height: 20px; border-radius: 10px; margin: auto;} /* ì¤‘ì•™ ì •ë ¬ */
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */
        .toast-container {
            position: fixed; top: 80px; right: 20px;
            z-index: 9999; display: flex; flex-direction: column; gap: 10px;
        }
        .toast {
            background: var(--content-bg); border: 1px solid var(--border-color);
            border-radius: var(--border-radius); padding: 12px 16px;
            box-shadow: var(--shadow-md); display: flex; align-items: center;
            gap: 10px; min-width: 300px; opacity: 0;
            transform: translateX(100%); animation: slideIn 0.3s ease-out forwards;
            color: var(--text-primary);
        }
        .toast.success { border-left: 4px solid var(--accent-green); }
        .toast.info    { border-left: 4px solid var(--accent-blue); }
        .toast.warning { border-left: 4px solid var(--accent-yellow); }
        .toast.error   { border-left: 4px solid var(--accent-red); }
        .toast-icon { font-size: 1.1rem; }
        .toast.success .toast-icon { color: var(--accent-green); }
        .toast.info .toast-icon    { color: var(--accent-blue); }
        .toast.warning .toast-icon { color: var(--accent-yellow); }
        .toast.error .toast-icon   { color: var(--accent-red); }
        .toast-message { flex: 1; font-size: 0.9rem; font-weight: 500; }
        .toast-close {
            background: none; border: none; color: var(--text-secondary);
            cursor: pointer; font-size: 1.2rem; padding: 0; transition: color 0.2s ease;
        }
        .toast-close:hover { color: var(--text-primary); }
        @keyframes slideIn { to { opacity: 1; transform: translateX(0); } }
        @keyframes slideOut { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(100%); } }

        /* ë§ˆì´í¬ë¡œ ì• ë‹ˆë©”ì´ì…˜ ë° íš¨ê³¼ */
        .nav-item::before {
            content: ''; position: absolute; top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        .nav-item:hover::before { left: 100%; }
        .nav-item:hover { transform: translateX(5px); }

        .filters-container .filter-button, .theme-toggle, .column-toggle-btn { /* ë²„íŠ¼ë¥˜ ê³µí†µ í˜¸ë²„ */
            position: relative; overflow: hidden;
        }
        .filters-container .filter-button::before, .theme-toggle::before, .column-toggle-btn::before {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 0; height: 0; background: rgba(255,255,255,0.2);
            border-radius: 50%; transition: width 0.4s ease, height 0.4s ease; /* ë¶€ë“œëŸ½ê²Œ */
            transform: translate(-50%, -50%);
        }
        .filters-container .filter-button:hover::before, .theme-toggle:hover::before, .column-toggle-btn:hover::before {
            width: 250%; height: 250%; /* ë²„íŠ¼ì„ ì™„ì „íˆ ë®ë„ë¡ */
        }
        .filters-container .filter-button:hover, .theme-toggle:hover, .column-toggle-btn:hover {
            transform: translateY(-2px); /* ì•½ê°„ ëœ¨ëŠ” íš¨ê³¼ */
            box-shadow: var(--shadow-md); /* ê·¸ë¦¼ì ê°•í™” */
        }

        /* ì¹´ë“œ ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ */
        .stats-card, .filters-container, .data-table-container, .alert-card { animation: fadeInUp 0.6s ease-out; }
        .stats-card:nth-child(1) { animation-delay: 0.1s; }
        .stats-card:nth-child(2) { animation-delay: 0.2s; }
        .filters-container      { animation-delay: 0.1s; }
        .data-table-container   { animation-delay: 0.3s; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* í…Œì´ë¸” ì¤„ë¬´ëŠ¬ ê°•í™” */
        body:not(.dark-mode) .data-table tbody tr:nth-child(odd) { background-color: #ffffff; }
        body:not(.dark-mode) .data-table tbody tr:nth-child(even) { background-color: #f8f9fa; }
        body:not(.dark-mode) .data-table tbody tr:hover { background-color: #e3f2fd !important; }

        body.dark-mode .data-table tbody tr:nth-child(odd) { background-color: #2d2d2d; }
        body.dark-mode .data-table tbody tr:nth-child(even) { background-color: #363636; }
        body.dark-mode .data-table tbody tr:hover { background-color: #404040 !important; }

        .status-badge {
            padding: 5px 12px; border-radius: 15px; font-size: 0.75rem; font-weight: 700;
            display: inline-block; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .status-badge.status-active-cell { background-color: rgba(40, 167, 69, 0.1); color: #1a682b; }
        .status-badge.status-inactive-cell { background-color: rgba(220, 53, 69, 0.1); color: #8c2f2f; }
        body.dark-mode .status-badge.status-active-cell { background-color: rgba(40, 167, 69, 0.2); color: #6ee78f; }
        body.dark-mode .status-badge.status-inactive-cell { background-color: rgba(220, 53, 69, 0.2); color: #f87171; }


        /* ìƒì„¸ ë“œë¡­ë‹¤ìš´ */
        .detail-dropdown {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-left: 4px solid var(--sidebar-accent);
            border-radius: 0 8px 8px 0; /* í–‰ ì•„ë˜ì— ë¶™ë„ë¡ */
            margin: 0; padding: 0; overflow: hidden;
            transition: max-height 0.4s ease-in-out, padding 0.4s ease-in-out, margin 0.4s ease-in-out; /* ë¶€ë“œëŸ¬ìš´ ì „í™˜ */
            max-height: 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        body.dark-mode .detail-dropdown {
            background: linear-gradient(135deg, #3a3a3a 0%, #2d2d2d 100%);
            border-left-color: var(--sidebar-accent);
        }

        .detail-dropdown.show {
            max-height: 600px; /* ì¶©ë¶„í•œ ë†’ì´ */
            padding: 25px; margin: 5px 0; /* ìœ„ì•„ë˜ ì•½ê°„ì˜ ë§ˆì§„ */
        }

        .detail-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px;
        }
        .detail-section {
            background: var(--content-bg); /* ë‹¤í¬ëª¨ë“œ ì ìš© */
            padding: 20px; border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color); /* ë‹¤í¬ëª¨ë“œ ì ìš© */
        }
        .detail-section h4 {
            color: var(--sidebar-accent); font-size: 1rem; font-weight: 700;
            margin-bottom: 15px; padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color); /* ë‹¤í¬ëª¨ë“œ ì ìš© */
            display: flex; align-items: center; gap: 8px;
        }
        .detail-item {
            margin-bottom: 12px; font-size: 0.9rem; line-height: 1.6;
            display: flex; align-items: flex-start;
        }
        .detail-item strong {
            color: var(--text-primary); min-width: 80px; display: inline-block;
            font-weight: 600; margin-right: 12px; flex: 0 0 auto;
        }
        .detail-item span { flex: 1; color: var(--text-secondary); }
        
        .detail-full-width {
            grid-column: 1 / -1;
            background: #fff3cd; border: 1px solid #ffeaa7;
            border-radius: 8px; padding: 15px;
        }
        body.dark-mode .detail-full-width {
            background: #4f3f1f; border-color: #7f5f2f;
        }
        .detail-full-width .detail-item { margin-bottom: 0; }
        .detail-full-width strong { color: #856404; }
        body.dark-mode .detail-full-width strong { color: #e4c4a0; }


        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í˜„í™© í†µê³„ í˜ì´ì§€ (ìˆ˜ì •ë¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .page-section-header {
            font-size: 1.4rem; font-weight: 700; margin-bottom: 16px;
            border-left: 4px solid var(--accent-blue);
            padding-left: 12px; color: var(--text-primary);
            display: flex; align-items: center; gap: 10px;
        }

        .summary-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-item {
            background: var(--content-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .metric-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        .metric-icon {
            font-size: 1.8rem;
            width: 50px; height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
        }
        .metric-icon.blue { background-color: #3498db; }
        .metric-icon.green { background-color: #2ecc71; }
        .metric-icon.purple { background-color: #9b59b6; }
        .metric-icon.orange { background-color: #e67e22; }

        .metric-content .metric-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        .metric-content .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        .metric-content .metric-value-small { font-size: 1.1rem; }

        .tabs-container { margin-top: 25px; }
        .tab-links {
            display: flex;
            gap: 5px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: -2px; /* ì•„ë˜ í…Œë‘ë¦¬ì™€ ê²¹ì¹˜ê²Œ */
        }
        .tab-link {
            padding: 10px 20px;
            cursor: pointer;
            border: 2px solid transparent;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            background: #e9ecef;
            color: var(--text-secondary);
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .tab-link.active {
            background: var(--content-bg);
            border-color: var(--border-color);
            color: var(--text-primary);
            border-bottom: 2px solid var(--content-bg);
        }
        .tab-content {
            display: none;
            background: var(--content-bg);
            padding: 20px;
            border: 2px solid var(--border-color);
            border-radius: 0 8px 8px 8px;
            animation: fadeInUp 0.4s ease;
        }

        .stats-detail-table {
            width: 100%;
            border-collapse: collapse;
        }
        .stats-detail-table th, .stats-detail-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            text-align: left;
        }
        .stats-detail-table th {
            background-color: #f8f9fa;
            font-weight: 700;
        }
        .stats-detail-table td:not(:first-child),
        .stats-detail-table th:not(:first-child) {
            text-align: right;
        }
        .stats-summary-row {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .stats-summary-row:hover {
            background-color: #f0f8ff;
        }
        .stats-summary-row.expanded {
            background-color: #e3f2fd;
            font-weight: 700;
        }

        .stats-detail-row {
            display: none;
        }
        .stats-detail-content {
            background-color: #fafafa;
            padding: 15px;
            box-shadow: inset 0 3px 5px rgba(0,0,0,0.04);
        }
        .stats-sub-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        .stats-sub-table th, .stats-sub-table td {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            vertical-align: middle;
        }
        .stats-sub-table th {
            background-color: #e9ecef;
        }
        
        .stats-note {
            background: #fff8e1; border: 1px solid #ffeeba;
            border-radius: var(--border-radius); padding: 15px 20px;
            color: #856404; font-size: 0.9rem; display: flex; align-items: center;
            margin-top: 25px;
        }
        body.dark-mode .stats-note {
            background: #4f3f1f; border-color: #7f5f2f; color: #e4c4a0;
        }
        .stats-note i { margin-right: 8px; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1200px) {
            .filters-container { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
            .data-table th, .data-table td { padding: 12px 10px; font-size: 0.85rem; max-width: 120px; }
            .data-table td.remarks-cell { max-width: 150px; }
        }
        @media (max-width: 1040px) { /* íƒœë¸”ë¦¿ ë° ì‘ì€ ë°ìŠ¤í¬íƒ‘ */
            .sidebar { transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
            .sidebar.mobile-active { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .mobile-menu-toggle { display: block !important; }
            .content-area { padding: 20px 15px; }
            .main-header { padding: 15px 20px; flex-wrap: wrap; gap: 10px; }
            .main-title { font-size: 1.4rem; }
            .main-breadcrumb { font-size: 0.8rem; }
            .summary-metrics-grid { grid-template-columns: 1fr; }
            .data-table { min-width: 700px; }
            .data-table th, .data-table td { font-size: 0.8rem; padding: 10px 8px; max-width: 100px; }
            .data-table td.remarks-cell { max-width: 120px; min-width: 80px; }
            /* .data-table th { position: static; } í—¤ë” ê³ ì • ìœ ì§€ */
            .filters-container { grid-template-columns: 1fr; gap: 15px; }
            .detail-grid { grid-template-columns: 1fr; gap: 15px; }
            .detail-section { padding: 15px; }
            .detail-dropdown.show { padding: 15px; }
        }
        @media (max-width: 768px) { /* ëª¨ë°”ì¼ */
            .main-header { flex-direction: column; align-items: flex-start; }
            .theme-toggle { align-self: flex-end; margin-top: 10px; } /* ìœ„ì¹˜ ì¡°ì • */
            .data-table { min-width: 600px; }
            .data-table th, .data-table td { padding: 8px 6px; font-size: 0.75rem; max-width: 80px; }
            .data-table td.remarks-cell { max-width: 100px; }
        }
        @media (max-width: 480px) { /* ì‘ì€ ëª¨ë°”ì¼ */
            .main-title { font-size: 1.2rem; }
            .main-breadcrumb { font-size: 0.75rem; }
            .content-area { padding: 15px 10px; }
            .data-table { min-width: 500px; }
            .data-table th, .data-table td { font-size: 0.7rem; padding: 6px 4px; max-width: 70px; }
            .data-table td.remarks-cell { max-width: 80px; }
            .filters-container { padding: 15px; }
            .toast-container { right: 10px; top: 70px; } /* í† ìŠ¤íŠ¸ ìœ„ì¹˜ ì¡°ì • */
            .toast { min-width: 280px; }
        }

        .loading {
            text-align: center; padding: 40px 20px; color: var(--text-secondary); font-size: 1rem;
        }

        /* ëª¨ë‹¬ (í˜„ì¬ ì‚¬ìš© ì•ˆí•¨, í•„ìš”ì‹œ í™œì„±í™”) */
        .modal {
            display: none; position: fixed; z-index: 2000;
            left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            background-color: var(--content-bg); margin: 10% auto; padding: 25px;
            border: 1px solid var(--border-color); border-radius: var(--border-radius);
            width: 80%; max-width: 700px; box-shadow: var(--shadow-lg);
            animation: modalOpen 0.3s ease-out;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); margin-bottom: 15px; }
        .modal-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); }
        .modal-close-btn { background:none; border:none; font-size:1.5rem; cursor:pointer; color: var(--text-secondary); }
        .modal-close-btn:hover { color: var(--text-primary); }
        .modal-body { line-height: 1.7; }
        @keyframes modalOpen { from { opacity:0; transform: translateY(-50px); } to { opacity:1; transform: translateY(0); } }

    </style>
</head>
<body>
    <div class="app-container">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">CFC í˜„í™©íŒ</div>
                <div class="sidebar-subtitle">ì‚¬ë¬´ì‹¤ ìì› ê´€ë¦¬</div>
            </div>
            <div class="nav-menu">
                <button class="nav-item active" onclick="switchPage('overview', this)">
                    <i class="fas fa-tachometer-alt icon"></i>ì‚¬ë¬´ì‹¤ í˜„í™©
                </button>
                <button class="nav-item" onclick="switchPage('stats', this)">
                    <i class="fas fa-chart-pie icon"></i>í˜„í™© í†µê³„
                </button>
            </div>

            <div class="sidebar-alert-wrapper">
                <div class="alert-card" id="sidebarAlertCard">
                    <div class="alert-card-header">
                        <i class="fas fa-exclamation-circle"></i> ê³„ì•½ ë§Œë£Œ ì„ë°• í˜„í™©
                    </div>
                    <div class="alert-card-body" id="sidebarAlertBody">
                        <div class="alert-period">
                            <i class="fas fa-calendar-check"></i> ì„ë°• ì‚¬ë¬´ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="overlay" id="overlay" onclick="toggleMobileMenu()"></div>
        <main class="main-content" id="mainContent">
            <header class="main-header">
                <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="main-title-container">
                    <h1 class="main-title" id="pageTitle">CFC ì‚¬ë¬´ì‹¤ ì„ëŒ€ í˜„í™©</h1>
                    <div class="main-breadcrumb" id="pageBreadcrumb">í™ˆ > ì‚¬ë¬´ì‹¤ í˜„í™©</div>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon"></i>
                    <span id="themeText">ë‹¤í¬ëª¨ë“œ</span>
                </button>
            </header>

            <div class="content-area">
                <div class="notice notice-info" id="statusNotice">
                    ğŸ”„ <strong>ì—°ê²° ì¤‘...</strong> Apps Scriptì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.
                </div>

                <div class="toast-container" id="toastContainer"></div>

                <div class="filters-container">
                    <div>
                        <label for="statusFilter">í˜„í™© ì„ íƒ:</label>
                        <select id="statusFilter" class="setup-input">
                            <option value="ì „ì²´">ì „ì²´</option>
                            <option value="ì‚¬ìš©ì¤‘">ì‚¬ìš©ì¤‘</option>
                            <option value="í‡´ê±°">í‡´ê±°</option>
                        </select>
                    </div>
                    <div>
                        <label for="usageFilter">ì‚¬ìš©ì²˜ ì„ íƒ:</label>
                        <select id="usageFilter" class="setup-input">
                            <option value="ì „ì²´">ì „ì²´</option>
                            </select>
                    </div>
                    <div>
                        <label for="regionFilter">ì§€ì—­ ì„ íƒ:</label>
                        <select id="regionFilter" class="setup-input">
                            <option value="ì „ì²´">ì „ì²´</option>
                            </select>
                    </div>
                    <div>
                        <label for="searchInput">ì§€ì ëª…/ì£¼ì†Œ/ì‚¬ìš©ì²˜/ì§€ì—­ ê²€ìƒ‰:</label>
                        <div class="autocomplete-container">
                            <input type="text" id="searchInput" placeholder="ì§€ì ëª…,ì£¼ì†Œ,ì‚¬ìš©ì²˜ ë˜ëŠ” ì§€ì—­ ì…ë ¥..." class="setup-input">
                            <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
                        </div>
                    </div>
                    <div>
                        <label for="expiryFilter">ë§Œë£Œì¼ í•„í„° (ì‚¬ìš©ì¤‘):</label>
                        <select id="expiryFilter" class="setup-input">
                            <option value="all">ì „ì²´ ê¸°ê°„</option>
                            <option value="30">30ì¼ ì´ë‚´ ë§Œë£Œ</option>
                            <option value="60">60ì¼ ì´ë‚´ ë§Œë£Œ</option>
                            <option value="90">90ì¼ ì´ë‚´ ë§Œë£Œ</option>
                            <option value="180">6ê°œì›” ì´ë‚´ ë§Œë£Œ</option>
                            <option value="365">1ë…„ ì´ë‚´ ë§Œë£Œ</option>
                        </select>
                    </div>
                    <div> <button id="resetFiltersBtn" class="filter-button">
                            <i class="fas fa-undo"></i> í•„í„° ì´ˆê¸°í™”
                        </button>
                    </div>
                    <div class="column-toggle-container">
                        <button class="column-toggle-btn" onclick="toggleColumnDropdown()">
                            <i class="fas fa-columns"></i> ì»¬ëŸ¼ ì„¤ì •
                        </button>
                        <div class="column-toggle-dropdown" id="columnToggleDropdown">
                            <div class="column-toggle-item">
                                <input type="checkbox" id="col-í˜„í™©" checked>
                                <label for="col-í˜„í™©">í˜„í™©</label>
                            </div>
                            <div class="column-toggle-item">
                                <input type="checkbox" id="col-ì‚¬ìš©ì²˜" checked>
                                <label for="col-ì‚¬ìš©ì²˜">ì‚¬ìš©ì²˜</label>
                            </div>
                            <div class="column-toggle-item">
                                <input type="checkbox" id="col-ì§€ì—­" checked>
                                <label for="col-ì§€ì—­">ì§€ì—­</label>
                            </div>
                            <div class="column-toggle-item">
                                <input type="checkbox" id="col-ì§€ì ëª…" checked>
                                <label for="col-ì§€ì ëª…">ì§€ì ëª…</label>
                            </div>
                            <div class="column-toggle-item">
                                <input type="checkbox" id="col-ê³„ì•½ì¼" checked>
                                <label for="col-ê³„ì•½ì¼">ê³„ì•½ì¼</label>
                            </div>
                            <div class="column-toggle-item">
                                <input type="checkbox" id="col-ë§Œë£Œì¼" checked>
                                <label for="col-ë§Œë£Œì¼">ë§Œë£Œì¼</label>
                            </div>
                            <div class="column-toggle-item">
                                <input type="checkbox" id="col-ë‚¨ì€ê¸°ê°„" checked>
                                <label for="col-ë‚¨ì€ê¸°ê°„">ë‚¨ì€ ê¸°ê°„</label>
                            </div>
                            <div class="column-toggle-item">
                                <input type="checkbox" id="col-ë³´ì¦ê¸ˆ" checked>
                                <label for="col-ë³´ì¦ê¸ˆ">ë³´ì¦ê¸ˆ</label>
                            </div>
                            <div class="column-toggle-item">
                                <input type="checkbox" id="col-ì›”ì„¸" checked>
                                <label for="col-ì›”ì„¸">ì›”ì„¸</label>
                            </div>
                            </div>
                    </div>
                </div>

                <div class="filter-summary-card" id="filterSummaryCard">
                    <div class="summary-title">
                        <i class="fas fa-chart-bar"></i> í•„í„° ê²°ê³¼ ìš”ì•½
                    </div>
                    <div class="summary-stats">
                        <div class="summary-stat">
                            <span class="summary-stat-value" id="summaryTotal">0</span>
                            <div class="summary-stat-label">ì´ ì‚¬ë¬´ì‹¤</div>
                        </div>
                        <div class="summary-stat">
                            <span class="summary-stat-value" id="summaryActive">0</span>
                            <div class="summary-stat-label">ì‚¬ìš©ì¤‘</div>
                        </div>
                        <div class="summary-stat">
                            <span class="summary-stat-value" id="summaryExpiring">0</span>
                            <div class="summary-stat-label">6ê°œì›”ë‚´ ë§Œë£Œ</div>
                        </div>
                        <div class="summary-stat">
                            <span class="summary-stat-value" id="summaryTotalRent">0ì›</span>
                            <div class="summary-stat-label">ì´ ì›”ì„¸</div>
                        </div>
                    </div>
                </div>

                <div class="data-table-container" id="officesTableContainer">
                    <table class="skeleton-table">
                        <thead>
                            <tr>
                                <th>í˜„í™©</th><th>ì§€ì ëª…</th><th>ê³„ì•½ì¼</th><th>ë§Œë£Œì¼</th>
                                <th>ë‚¨ì€ ê¸°ê°„</th><th>ë³´ì¦ê¸ˆ (ì›)</th><th>ì›”ì„¸ (ì›)</th>
                                </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><div class="skeleton-item badge"></div></td><td><div class="skeleton-item medium"></div></td>
                                <td><div class="skeleton-item short"></div></td><td><div class="skeleton-item short"></div></td>
                                <td><div class="skeleton-item short"></div></td><td><div class="skeleton-item medium"></div></td>
                                <td><div class="skeleton-item medium"></div></td>
                            </tr>
                             <tr>
                                <td><div class="skeleton-item badge"></div></td><td><div class="skeleton-item"></div></td>
                                <td><div class="skeleton-item short"></div></td><td><div class="skeleton-item short"></div></td>
                                <td><div class="skeleton-item short"></div></td><td><div class="skeleton-item medium"></div></td>
                                <td><div class="skeleton-item medium"></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="statsSection" style="display: none;">
                    <div class="page-section-header">
                        <i class="fas fa-tasks"></i>
                        <span>ì£¼ìš” ì§€í‘œ ìš”ì•½</span>
                    </div>

                    <div class="summary-metrics-grid">
                        <div class="metric-item">
                            <div class="metric-icon blue"><i class="fas fa-building"></i></div>
                            <div class="metric-content">
                                <div class="metric-label">ì‚¬ìš©ì¤‘ ì‚¬ë¬´ì‹¤</div>
                                <div class="metric-value" id="metricActiveOffices">- ê°œì†Œ</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon green"><i class="fas fa-wallet"></i></div>
                            <div class="metric-content">
                                <div class="metric-label">ì›”ì„¸ ì´ì•¡ (ë§¤ì›”)</div>
                                <div class="metric-value" id="metricTotalRent">- ì›</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon purple"><i class="fas fa-piggy-bank"></i></div>
                            <div class="metric-content">
                                <div class="metric-label">ë³´ì¦ê¸ˆ ì´ì•¡</div>
                                <div class="metric-value" id="metricTotalDeposit">- ì›</div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-icon orange"><i class="fas fa-calculator"></i></div>
                             <div class="metric-content">
                                <div class="metric-label">í‰ê·  ì›”ì„¸</div>
                                <div class="metric-value metric-value-small" id="metricAvgRent">- ì›</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="page-section-header" style="margin-top: 40px;">
                        <i class="fas fa-chart-pie"></i>
                        <span>ìƒì„¸ ë¶„ì„</span>
                    </div>

                    <div class="tabs-container">
                        <div class="tab-links">
                            <button class="tab-link active" onclick="openStatTab(event, 'regionStats')">
                                <i class="fas fa-map-marker-alt"></i> ì§€ì—­ë³„ í†µê³„
                            </button>
                            <button class="tab-link" onclick="openStatTab(event, 'usageStats')">
                                <i class="fas fa-tags"></i> ì‚¬ìš©ì²˜ë³„ í†µê³„
                            </button>
                        </div>

                        <div id="regionStats" class="tab-content">
                            </div>
                        <div id="usageStats" class="tab-content">
                             </div>
                    </div>

                    <div class="stats-note">
                        <i class="fas fa-info-circle"></i>
                        <span>ëª¨ë“  í†µê³„ëŠ” í˜„ì¬ 'ì‚¬ìš©ì¤‘' ìƒíƒœì¸ ì‚¬ë¬´ì‹¤ë§Œì„ ê¸°ì¤€ìœ¼ë¡œ ì‚°ì •ë©ë‹ˆë‹¤.</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="officeDetailModal" class="modal">
        </div>

    <script>
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì „ì—­ ë³€ìˆ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let connectionData = [];
        let allOfficeData = [];
        let filteredOfficeData = [];
        let searchTerm = ''; // applyAllFiltersì—ì„œ ì§ì ‘ input ê°’ì„ ì½ìœ¼ë¯€ë¡œ, ì´ ë³€ìˆ˜ëŠ” ìë™ì™„ì„± ë“± ë³´ì¡° ìš©ë„
        let currentExpiryFilter = 'all';
        let currentSortColumn = '';
        let currentSortDirection = ''; // 'asc', 'desc', ë˜ëŠ” '' (ê¸°ë³¸/ì •ë ¬ í•´ì œ)
        let isDarkMode = false;
        let autocompleteData = [];
        let selectedAutocompleteIndex = -1;
        let visibleColumns = {
            'í˜„í™©': true, 'ì‚¬ìš©ì²˜': true, 'ì§€ì—­': true, 'ì§€ì ëª…': true, 'ê³„ì•½ì¼': true, 'ë§Œë£Œì¼': true,
            'ë‚¨ì€ê¸°ê°„': true, 'ë³´ì¦ê¸ˆ': true, 'ì›”ì„¸': true, 'ë¹„ê³ ': false
        };
        let expandedOfficeId = null; // í˜„ì¬ ì—´ë¦° ìƒì„¸ ì •ë³´ í–‰ ID
        let expandedStatRow = null; // í†µê³„ í…Œì´ë¸”ì—ì„œ í˜„ì¬ ì—´ë¦° í–‰

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DOMContentLoaded â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        window.addEventListener('DOMContentLoaded', function() {
            loadThemeFromStorage();
            
            document.getElementById('searchInput').addEventListener('input', e => {
                handleAutocomplete(e.target.value); 
                applyAllFilters();
            });
            document.getElementById('searchInput').addEventListener('keydown', handleAutocompleteKeydown);
            document.getElementById('searchInput').addEventListener('blur', () => {
                setTimeout(() => hideAutocomplete(), 150);
            });
            document.getElementById('expiryFilter').addEventListener('change', e => {
                currentExpiryFilter = e.target.value;
                applyAllFilters();
            });
            document.getElementById('statusFilter').addEventListener('change', applyAllFilters);
            document.getElementById('usageFilter').addEventListener('change', applyAllFilters); // New
            document.getElementById('regionFilter').addEventListener('change', applyAllFilters); // New

            document.getElementById('resetFiltersBtn').addEventListener('click', () => {
                searchTerm = ''; currentExpiryFilter = 'all';
                document.getElementById('searchInput').value = '';
                document.getElementById('expiryFilter').value = 'all';
                document.getElementById('statusFilter').value = 'ì „ì²´';
                document.getElementById('usageFilter').value = 'ì „ì²´'; // New
                document.getElementById('regionFilter').value = 'ì „ì²´'; // New
                currentSortColumn = ''; currentSortDirection = ''; 
                // populateUsageAndRegionFilters(); // Re-populate to ensure "ì „ì²´" is selected if options changed dynamically
                applyAllFilters();
                showToast('í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'info', 2000);
            });

            document.addEventListener('click', (e) => {
                const columnToggleContainer = document.querySelector('.column-toggle-container');
                const dropdown = document.getElementById('columnToggleDropdown');
                if (dropdown && columnToggleContainer && !columnToggleContainer.contains(e.target)) {
                   if(dropdown.style.display === 'block') {
                       dropdown.style.display = 'none';
                   }
                }
            });

            updatePageTitleAndBreadcrumb('overview');
            connectAppsScript();
            setupColumnToggles();
        });

        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwcujFRpQbOeSuaa7YTIr6AEsLt4ShLLJCq8pSb1jngQUKJfogA3h3emm_V3EOnVfygFg/exec';

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Apps Script ì—°ê²° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function connectAppsScript() {
            const notice = document.getElementById('statusNotice');
            notice.className = 'notice notice-info';
            notice.style.display = 'block';
            notice.innerHTML = 'ğŸ”„ <strong>ì—°ê²° ì¤‘...</strong> Apps Scriptì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.';
            showSkeletonTable(); 

            // Apps Scriptê°€ ê¸°ëŒ€í•˜ëŠ” 'sheet' íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ê³ , 'action' íŒŒë¼ë¯¸í„°ëŠ” ì œê±°í•©ë‹ˆë‹¤.
            // 'sheetName' ëŒ€ì‹  'sheet'ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
            fetch(`${APPS_SCRIPT_URL}?sheet=ì„ëŒ€í˜„í™©&t=${Date.now()}`, { // ì´ë ‡ê²Œ ìˆ˜ì •!
                method: 'GET', headers: { 'Accept': 'application/json' }
            })
            .then(response => {
                if (!response.ok) return Promise.reject(`HTTP ${response.status}: ${response.statusText}`);
                return response.json();
            })
            .then(result => {
                // Apps Scriptì˜ ì‘ë‹µ êµ¬ì¡°ì— ë§ì¶°ì„œ ë°ì´í„° ì²˜ë¦¬ (result.dataê°€ ì‹¤ì œ ë°ì´í„° ë°°ì—´)
                if (result && result.status === 'success' && Array.isArray(result.data)) {
                    handleConnectionSuccess(result.data);
                } else if (Array.isArray(result)) { // í˜¹ì‹œ ì´ì „ì²˜ëŸ¼ ë°ì´í„° ë°°ì—´ë§Œ ë°”ë¡œ ì˜¤ëŠ” ê²½ìš°ë„ ê³ ë ¤ (í˜¸í™˜ì„±)
                    handleConnectionSuccess(result);
                }
                else {
                    // ì—ëŸ¬ ë©”ì‹œì§€ê°€ result.error ë˜ëŠ” result.message ì— ë‹´ê²¨ ì˜¬ ìˆ˜ ìˆìŒ
                    let errorMessage = 'ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ í˜•ì‹';
                    if (result && result.message) errorMessage = result.message;
                    if (result && result.error) errorMessage += ` (${result.error})`;
                    return Promise.reject(errorMessage + ': ' + JSON.stringify(result));
                }
            })
            .catch(error => {
                handleConnectionError(error);
            });
        }

        function handleConnectionSuccess(sheetData) {
            connectionData = sheetData; 
            const notice = document.getElementById('statusNotice');
            notice.className = 'notice notice-success';
            notice.innerHTML = 'âœ… <strong>ì—°ê²° ì„±ê³µ!</strong> ë°ì´í„°ë¥¼ ì •ìƒì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.';
            setTimeout(() => { if(notice) notice.style.display = 'none'; }, 3000);

            parseAndRenderOfficeData(sheetData); 
            populateUsageAndRegionFilters(); // Populate new filters
            setupAutocompleteData(); 
            updateSidebarAlert(allOfficeData); 
        }

        function handleConnectionError(error) {
            const notice = document.getElementById('statusNotice');
            if(notice) {
                notice.className = 'notice notice-warning';
                notice.style.display = 'block';
                let msg = typeof error === 'string' ? error : (error.message || JSON.stringify(error));
                notice.innerHTML = `âŒ <strong>ì—°ê²° ì‹¤íŒ¨:</strong> ${msg}`;
            }
            showMessageOnTable(`ì—°ê²° ì˜¤ë¥˜: ${typeof error === 'string' ? error : error.message}. Google Apps Script URL ë˜ëŠ” ì‹œíŠ¸ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.`);
        }

        function showSkeletonTable() {
            const container = document.getElementById('officesTableContainer');
            if (!container) return;
            let headers = '';
            if (visibleColumns['í˜„í™©']) headers += '<th>í˜„í™©</th>';
            if (visibleColumns['ì‚¬ìš©ì²˜']) headers += '<th>ì‚¬ìš©ì²˜</th>';
            if (visibleColumns['ì§€ì—­']) headers += '<th>ì§€ì—­</th>';
            if (visibleColumns['ì§€ì ëª…']) headers += '<th>ì§€ì ëª…</th>';
            if (visibleColumns['ê³„ì•½ì¼']) headers += '<th>ê³„ì•½ì¼</th>';
            if (visibleColumns['ë§Œë£Œì¼']) headers += '<th>ë§Œë£Œì¼</th>';
            if (visibleColumns['ë‚¨ì€ê¸°ê°„']) headers += '<th>ë‚¨ì€ ê¸°ê°„</th>';
            if (visibleColumns['ë³´ì¦ê¸ˆ']) headers += '<th>ë³´ì¦ê¸ˆ (ì›)</th>';
            if (visibleColumns['ì›”ì„¸']) headers += '<th>ì›”ì„¸ (ì›)</th>';
            if (visibleColumns['ë¹„ê³ ']) headers += '<th>ë¹„ê³ </th>';


            let skeletonRows = '';
            for (let i = 0; i < 5; i++) { 
                skeletonRows += '<tr>';
                if (visibleColumns['í˜„í™©']) skeletonRows += '<td><div class="skeleton-item badge"></div></td>';
                if (visibleColumns['ì‚¬ìš©ì²˜']) skeletonRows += '<td><div class="skeleton-item badge"></div></td>';
                if (visibleColumns['ì§€ì—­']) skeletonRows += '<td><div class="skeleton-item badge"></div></td>';
                if (visibleColumns['ì§€ì ëª…']) skeletonRows += `<td><div class="skeleton-item ${i % 2 === 0 ? 'medium' : ''}"></div></td>`;
                if (visibleColumns['ê³„ì•½ì¼']) skeletonRows += '<td><div class="skeleton-item short"></div></td>';
                if (visibleColumns['ë§Œë£Œì¼']) skeletonRows += '<td><div class="skeleton-item short"></div></td>';
                if (visibleColumns['ë‚¨ì€ê¸°ê°„']) skeletonRows += '<td><div class="skeleton-item short"></div></td>';
                if (visibleColumns['ë³´ì¦ê¸ˆ']) skeletonRows += '<td><div class="skeleton-item medium"></div></td>';
                if (visibleColumns['ì›”ì„¸']) skeletonRows += '<td><div class="skeleton-item medium"></div></td>';
                if (visibleColumns['ë¹„ê³ ']) skeletonRows += `<td><div class="skeleton-item ${i % 2 === 0 ? '' : 'medium'}"></div></td>`;
                skeletonRows += '</tr>';
            }
            container.innerHTML = `<table class="skeleton-table"><thead><tr>${headers}</tr></thead><tbody>${skeletonRows}</tbody></table>`;
        }


        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë°ì´í„° íŒŒì‹± & í…Œì´ë¸” ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function parseAndRenderOfficeData(rawData) {
            if (!rawData || rawData.length < 1) {
                allOfficeData = [];
                applyAllFilters(); 
                return;
            }

            let headerIdx = -1;
            for (let i = 0; i < Math.min(10, rawData.length); i++) {
                const row = rawData[i];
                if (Array.isArray(row) && row.some(cell => cell && String(cell).trim() === 'ì§€ì ëª…')) {
                    headerIdx = i;
                    break;
                }
            }

            if (headerIdx < 0) {
                allOfficeData = [];
                showMessageOnTable('âš ï¸ ì‹œíŠ¸ì—ì„œ "ì§€ì ëª…" í—¤ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë°ì´í„° í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }

            const headers = rawData[headerIdx].map(h => h ? String(h).trim() : '');
            
            allOfficeData = [];
            for (let i = headerIdx + 1; i < rawData.length; i++) {
                const row = rawData[i];
                const branchNameIndex = headers.indexOf('ì§€ì ëª…');
                if (!Array.isArray(row) || (branchNameIndex === -1 || !row[branchNameIndex]) && row.every(cell => !cell)) {
                    continue;
                }

                const office = { id: `office_${i}` };
                headers.forEach((header, index) => {
                    if (header) {
                        office[header] = (row[index] !== undefined && row[index] !== null) ? row[index] : '';
                    }
                });
                
                office.ì§€ì ëª… = String(office['ì§€ì ëª…'] || '');
                office.í˜„í™© = String(office['í˜„í™©'] || '');
                office.ì£¼ì†Œ = String(office['ì£¼ì†Œ'] || '');
                office.ì‚¬ìš©ì²˜ = String(office['ì‚¬ìš©ì²˜'] || ''); // Ensure ì‚¬ìš©ì²˜ is processed
                office.ì§€ì—­ = String(office['ì§€ì—­'] || '');   // Ensure ì§€ì—­ is processed
                const rawContractDate = office['ê³„ì•½ì¼']; 
                const rawExpiryDate = office['ë§Œë£Œì¼'];   
                office.ì›”ì„¸_ì›ë³¸ = office['ì›”ì„¸']; 
                office.ë³´ì¦ê¸ˆ_ì›ë³¸ = office['ë³´ì¦ê¸ˆ']; 
                office.ì„ëŒ€ì¸ = String(office['ì„ëŒ€ì¸'] || '');
                office.ì—°ë½ì²˜ = String(office['ì—°ë½ì²˜'] || '');
                office.ë©´ì _ì›ë³¸ = office['ì´ë©´ì ']; 
                office.í‰í˜•_ì›ë³¸ = office['í‰í˜•'];
                office.ë¹„ê³  = String(office['ë¹„ê³ '] || '');

                if (rawExpiryDate) {
                    const parsedExpiryDate = parseDateValue(rawExpiryDate);
                    if (parsedExpiryDate && !isNaN(parsedExpiryDate.getTime())) {
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        const expiryDateForComparison = new Date(parsedExpiryDate.getFullYear(), parsedExpiryDate.getMonth(), parsedExpiryDate.getDate());
                        expiryDateForComparison.setHours(0, 0, 0, 0);
                        office.ë‚¨ì€ì¼ìˆ˜ = Math.ceil((expiryDateForComparison - today) / (1000 * 60 * 60 * 24));
                    } else {
                        office.ë‚¨ì€ì¼ìˆ˜ = null;
                    }
                } else {
                    office.ë‚¨ì€ì¼ìˆ˜ = null;
                }

                office.ê³„ì•½ì¼ = formatDate(rawContractDate);
                office.ë§Œë£Œì¼ = formatDate(rawExpiryDate);
                office.ì›”ì„¸ = formatNumber(office.ì›”ì„¸_ì›ë³¸);
                office.ë³´ì¦ê¸ˆ = formatNumber(office.ë³´ì¦ê¸ˆ_ì›ë³¸);
                office.ë©´ì  = formatNumber(office.ë©´ì _ì›ë³¸);
                office.í‰í˜• = office.í‰í˜•_ì›ë³¸ ? parseFloat(office.í‰í˜•_ì›ë³¸) : 0; 

                office.rawRowData = row; 
                office.headers = headers; 
                allOfficeData.push(office);
            }
            populateUsageAndRegionFilters(); // Populate filters after allOfficeData is ready
            applyAllFilters(); 
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í•„í„° ì˜µì…˜ ë™ì  ìƒì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function populateSelectWithOptions(selectElementId, items, defaultOptionText = "ì „ì²´") {
            const selectElement = document.getElementById(selectElementId);
            if (!selectElement) return;

            const currentSelectedValue = selectElement.value;

            // ê¸°ì¡´ ì˜µì…˜ë“¤ ì œê±° (ê¸°ë³¸ "ì „ì²´" ì˜µì…˜ ì œì™¸)
            while (selectElement.options.length > 1) {
                selectElement.remove(1);
            }

            const uniqueItems = [...new Set(items.map(item => String(item || '').trim()).filter(item => item !== ''))].sort((a, b) => a.localeCompare(b, 'ko'));
            
            uniqueItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                selectElement.appendChild(option);
            });
            
            // ì´ì „ì— ì„ íƒëœ ê°’ ë˜ëŠ” ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›
            if (Array.from(selectElement.options).some(opt => opt.value === currentSelectedValue)) {
                selectElement.value = currentSelectedValue;
            } else {
                 selectElement.value = defaultOptionText; 
            }
        }

        function populateUsageAndRegionFilters() {
            if (allOfficeData.length === 0) { // ë°ì´í„° ì—†ìœ¼ë©´ ê¸°ë³¸ ì˜µì…˜ë§Œ ìœ ì§€
                populateSelectWithOptions('usageFilter', []);
                populateSelectWithOptions('regionFilter', []);
                return;
            }

            const usages = allOfficeData.map(o => o.ì‚¬ìš©ì²˜);
            const regions = allOfficeData.map(o => o.ì§€ì—­);

            populateSelectWithOptions('usageFilter', usages);
            populateSelectWithOptions('regionFilter', regions);
        }


        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í•„í„° ì ìš© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function applyAllFilters() {
            let data = allOfficeData.slice();
            const searchInputVal = document.getElementById('searchInput').value || '';
            const term = searchInputVal.trim().toLowerCase();

            if (term) {
                data = data.filter(o => {
                    const nameVal = String(o.ì§€ì ëª… || '').toLowerCase();
                    const addrVal = String(o.ì£¼ì†Œ || '').toLowerCase();
                    const usageVal = String(o.ì‚¬ìš©ì²˜ || '').toLowerCase(); // Search includes usage
                    const regionVal = String(o.ì§€ì—­ || '').toLowerCase(); // Search includes region
                    return nameVal.includes(term) || addrVal.includes(term) || usageVal.includes(term) || regionVal.includes(term);
                });
            }

            const statusVal = (document.getElementById('statusFilter').value || '').trim();
            if (statusVal && statusVal !== 'ì „ì²´') {
                data = data.filter(o => o.í˜„í™© === statusVal);
            }

            const usageVal = (document.getElementById('usageFilter').value || '').trim(); // New filter
            if (usageVal && usageVal !== 'ì „ì²´') {
                data = data.filter(o => String(o.ì‚¬ìš©ì²˜ || '') === usageVal);
            }

            const regionVal = (document.getElementById('regionFilter').value || '').trim(); // New filter
            if (regionVal && regionVal !== 'ì „ì²´') {
                data = data.filter(o => String(o.ì§€ì—­ || '') === regionVal);
            }

            const expiryVal = (document.getElementById('expiryFilter').value || '').trim();
            if (expiryVal && expiryVal !== 'all') {
                const thresh = parseInt(expiryVal, 10);
                data = data.filter(o => {
                    if (o.í˜„í™© !== 'ì‚¬ìš©ì¤‘') return false;
                    if (o.ë‚¨ì€ì¼ìˆ˜ === null || isNaN(o.ë‚¨ì€ì¼ìˆ˜)) return false;
                    return o.ë‚¨ì€ì¼ìˆ˜ >= 0 && o.ë‚¨ì€ì¼ìˆ˜ <= thresh;
                });
            }
            
            if (currentSortColumn && currentSortDirection) {
                 data.sort((a, b) => {
                    let aVal = a[currentSortColumn];
                    let bVal = b[currentSortColumn];

                    if (currentSortColumn === 'ë‚¨ì€ì¼ìˆ˜') {
                        aVal = aVal === null || isNaN(aVal) ? (currentSortDirection === 'asc' ? Infinity : -Infinity) : Number(aVal);
                        bVal = bVal === null || isNaN(bVal) ? (currentSortDirection === 'asc' ? Infinity : -Infinity) : Number(bVal);
                        return currentSortDirection === 'asc' ? aVal - bVal : bVal - aVal;
                    }
                    if (currentSortColumn === 'ë³´ì¦ê¸ˆ' || currentSortColumn === 'ì›”ì„¸') {
                        aVal = parseFloat(String(a[currentSortColumn+'_ì›ë³¸'] || '0').replace(/,/g, '')) || 0; 
                        bVal = parseFloat(String(b[currentSortColumn+'_ì›ë³¸'] || '0').replace(/,/g, '')) || 0;
                        return currentSortDirection === 'asc' ? aVal - bVal : bVal - aVal;
                    }
                    if (currentSortColumn === 'ê³„ì•½ì¼' || currentSortColumn === 'ë§Œë£Œì¼') {
                        const dateA = aVal ? parseDateValue(aVal) : null;
                        const dateB = bVal ? parseDateValue(bVal) : null;
                        if (!dateA && !dateB) return 0;
                        if (!dateA || isNaN(dateA.getTime())) return currentSortDirection === 'asc' ? 1 : -1;
                        if (!dateB || isNaN(dateB.getTime())) return currentSortDirection === 'asc' ? -1 : 1;
                        return currentSortDirection === 'asc' ? dateA - dateB : dateB - dateA;
                    }
                    // For 'ì‚¬ìš©ì²˜', 'ì§€ì—­', 'ì§€ì ëª…', 'í˜„í™©'
                    aVal = String(aVal || '').toLowerCase(); 
                    bVal = String(bVal || '').toLowerCase();
                    if (aVal < bVal) return currentSortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return currentSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }


            filteredOfficeData = data;
            renderOfficeTable(data);
            updateFilterSummary(data); 
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í…Œì´ë¸” ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderOfficeTable(offices) {
            try {
                const container = document.getElementById('officesTableContainer');
                if (!container) { console.error('í…Œì´ë¸” ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'); return; }

                if (!offices || offices.length === 0) {
                    const isActiveFilter = (document.getElementById('searchInput').value.trim() || 
                                       document.getElementById('statusFilter').value !== 'ì „ì²´' ||
                                       document.getElementById('usageFilter').value !== 'ì „ì²´' || // New
                                       document.getElementById('regionFilter').value !== 'ì „ì²´' || // New
                                       document.getElementById('expiryFilter').value !== 'all');
                    if (isActiveFilter || allOfficeData.length === 0 && connectionData.length === 0) {
                         showMessageOnTable('ì¡°ê±´ì— ë§ëŠ” ì‚¬ë¬´ì‹¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    } else if (allOfficeData.length === 0 && connectionData.length > 0) {
                         showMessageOnTable('ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í—¤ë” ë“±ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    }
                    return;
                }

                const visibleColCount = Object.values(visibleColumns).filter(Boolean).length;

                let headerHtml = '<tr>';
if (visibleColumns['í˜„í™©']) headerHtml += `<th class="sortable-header" data-sort="í˜„í™©" onclick="sortTable('í˜„í™©')">í˜„í™© <i class="fas ${currentSortColumn === 'í˜„í™©' ? (currentSortDirection === 'asc' ? 'fa-sort-up' : (currentSortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort')) : 'fa-sort'} sort-icon"></i></th>`;
if (visibleColumns['ì‚¬ìš©ì²˜']) headerHtml += `<th class="sortable-header" data-sort="ì‚¬ìš©ì²˜" onclick="sortTable('ì‚¬ìš©ì²˜')">ì‚¬ìš©ì²˜ <i class="fas ${currentSortColumn === 'ì‚¬ìš©ì²˜' ? (currentSortDirection === 'asc' ? 'fa-sort-up' : (currentSortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort')) : 'fa-sort'} sort-icon"></i></th>`;
if (visibleColumns['ì§€ì—­']) headerHtml += `<th class="sortable-header" data-sort="ì§€ì—­" onclick="sortTable('ì§€ì—­')">ì§€ì—­ <i class="fas ${currentSortColumn === 'ì§€ì—­' ? (currentSortDirection === 'asc' ? 'fa-sort-up' : (currentSortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort')) : 'fa-sort'} sort-icon"></i></th>`;
if (visibleColumns['ì§€ì ëª…']) headerHtml += `<th class="sortable-header" data-sort="ì§€ì ëª…" onclick="sortTable('ì§€ì ëª…')">ì§€ì ëª… <i class="fas ${currentSortColumn === 'ì§€ì ëª…' ? (currentSortDirection === 'asc' ? 'fa-sort-up' : (currentSortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort')) : 'fa-sort'} sort-icon"></i></th>`;
                if (visibleColumns['ê³„ì•½ì¼']) headerHtml += `<th class="sortable-header" data-sort="ê³„ì•½ì¼" onclick="sortTable('ê³„ì•½ì¼')">ê³„ì•½ì¼ <i class="fas ${currentSortColumn === 'ê³„ì•½ì¼' ? (currentSortDirection === 'asc' ? 'fa-sort-up' : (currentSortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort')) : 'fa-sort'} sort-icon"></i></th>`;
                if (visibleColumns['ë§Œë£Œì¼']) headerHtml += `<th class="sortable-header" data-sort="ë§Œë£Œì¼" onclick="sortTable('ë§Œë£Œì¼')">ë§Œë£Œì¼ <i class="fas ${currentSortColumn === 'ë§Œë£Œì¼' ? (currentSortDirection === 'asc' ? 'fa-sort-up' : (currentSortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort')) : 'fa-sort'} sort-icon"></i></th>`;
                if (visibleColumns['ë‚¨ì€ê¸°ê°„']) headerHtml += `<th class="sortable-header" data-sort="ë‚¨ì€ì¼ìˆ˜" onclick="sortTable('ë‚¨ì€ì¼ìˆ˜')">ë‚¨ì€ ê¸°ê°„ <i class="fas ${currentSortColumn === 'ë‚¨ì€ì¼ìˆ˜' ? (currentSortDirection === 'asc' ? 'fa-sort-up' : (currentSortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort')) : 'fa-sort'} sort-icon"></i></th>`;
                if (visibleColumns['ë³´ì¦ê¸ˆ']) headerHtml += `<th class="sortable-header" data-sort="ë³´ì¦ê¸ˆ" onclick="sortTable('ë³´ì¦ê¸ˆ')">ë³´ì¦ê¸ˆ (ì›) <i class="fas ${currentSortColumn === 'ë³´ì¦ê¸ˆ' ? (currentSortDirection === 'asc' ? 'fa-sort-up' : (currentSortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort')) : 'fa-sort'} sort-icon"></i></th>`;
                if (visibleColumns['ì›”ì„¸']) headerHtml += `<th class="sortable-header" data-sort="ì›”ì„¸" onclick="sortTable('ì›”ì„¸')">ì›”ì„¸ (ì›) <i class="fas ${currentSortColumn === 'ì›”ì„¸' ? (currentSortDirection === 'asc' ? 'fa-sort-up' : (currentSortDirection === 'desc' ? 'fa-sort-down' : 'fa-sort')) : 'fa-sort'} sort-icon"></i></th>`;
                headerHtml += '</tr>';

                let html = `<table class="data-table"><thead>${headerHtml}</thead><tbody>`;

                offices.forEach(o => {
                    const statusClass = o.í˜„í™© === 'ì‚¬ìš©ì¤‘' ? 'status-active-cell' : 'status-inactive-cell';
                    let rowStyle = '', daysStyle = '';
                    if (o.í˜„í™© === 'ì‚¬ìš©ì¤‘' && o.ë‚¨ì€ì¼ìˆ˜ !== null && o.ë‚¨ì€ì¼ìˆ˜ >= 0 && o.ë‚¨ì€ì¼ìˆ˜ <= 180) {
                        if (o.ë‚¨ì€ì¼ìˆ˜ <= 60) { 
                            rowStyle = `background-color: var(--danger-bg); color: var(--text-primary); font-weight:700;`;
                            daysStyle = `font-weight:700;`; 
                        } else { 
                            rowStyle = `background-color: var(--warning-bg); color: var(--text-primary); font-weight:650;`;
                            daysStyle = `font-weight:650;`;
                        }
                    }
                    
                    const daysText = (o.ë‚¨ì€ì¼ìˆ˜ !== null && !isNaN(o.ë‚¨ì€ì¼ìˆ˜))
                        ? (o.ë‚¨ì€ì¼ìˆ˜ < 0 ? `ë§Œë£Œ ${Math.abs(o.ë‚¨ì€ì¼ìˆ˜)}ì¼ ì§€ë‚¨` : (o.ë‚¨ì€ì¼ìˆ˜ === 0 ? 'ì˜¤ëŠ˜ë§Œë£Œ' : `${o.ë‚¨ì€ì¼ìˆ˜}ì¼`))
                        : (o.ë§Œë£Œì¼ ? '-' : '');

                    html += `<tr id="row-${o.id}" style="${rowStyle}" onclick="toggleOfficeDetails('${o.id}')">`;
if (visibleColumns['í˜„í™©']) html += `<td><span class="status-badge ${statusClass}">${o.í˜„í™© || '-'}</span></td>`;
if (visibleColumns['ì‚¬ìš©ì²˜']) html += `<td>${o.ì‚¬ìš©ì²˜ || '-'}</td>`;
if (visibleColumns['ì§€ì—­']) html += `<td>${o.ì§€ì—­ || '-'}</td>`;
if (visibleColumns['ì§€ì ëª…']) html += `<td>${o.ì§€ì ëª… || '-'}</td>`;
                    if (visibleColumns['ê³„ì•½ì¼']) html += `<td>${o.ê³„ì•½ì¼ || '-'}</td>`;
                    if (visibleColumns['ë§Œë£Œì¼']) html += `<td>${o.ë§Œë£Œì¼ || '-'}</td>`;
                    if (visibleColumns['ë‚¨ì€ê¸°ê°„']) html += `<td style="${daysStyle}">${daysText}</td>`;
                    if (visibleColumns['ë³´ì¦ê¸ˆ']) html += `<td>${o.ë³´ì¦ê¸ˆ || '-'}</td>`;
                    if (visibleColumns['ì›”ì„¸']) html += `<td>${o.ì›”ì„¸ || '-'}</td>`;
                    html += `</tr>`;

                    html += `<tr id="detail-${o.id}" class="detail-row" style="display:none;">
                                <td colspan="${visibleColCount > 0 ? visibleColCount : 1}" style="padding:0; border:none;">
                                    <div class="detail-dropdown" id="dropdown-${o.id}"></div>
                                </td>
                            </tr>`;
                });

                html += `</tbody></table>`;
                container.innerHTML = html;
            } catch (error) {
                console.error('í…Œì´ë¸” ë Œë”ë§ ì—ëŸ¬:', error);
                showMessageOnTable('í…Œì´ë¸” ë Œë”ë§ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê¸°íƒ€ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function updateSidebarAlert(dataToProcess) {
            const wrapper = document.getElementById('sidebarAlertBody');
            if (!wrapper) return;

            const soonAll = dataToProcess.filter(o => o.í˜„í™© === 'ì‚¬ìš©ì¤‘' && o.ë‚¨ì€ì¼ìˆ˜ !== null && o.ë‚¨ì€ì¼ìˆ˜ >= 0);
            const twoMonths = soonAll.filter(o => o.ë‚¨ì€ì¼ìˆ˜ <= 60).sort((a,b) => a.ë‚¨ì€ì¼ìˆ˜ - b.ë‚¨ì€ì¼ìˆ˜);
            const sixMonths = soonAll.filter(o => o.ë‚¨ì€ì¼ìˆ˜ > 60 && o.ë‚¨ì€ì¼ìˆ˜ <= 180).sort((a,b) => a.ë‚¨ì€ì¼ìˆ˜ - b.ë‚¨ì€ì¼ìˆ˜);

            if (!twoMonths.length && !sixMonths.length) {
                wrapper.innerHTML = `<div class="alert-period"><i class="fas fa-calendar-check"></i> ì„ë°• ì‚¬ë¬´ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }
            let html = '';
            if (twoMonths.length > 0) {
                html += `<div class="alert-period"><i class="fas fa-exclamation-triangle" style="color: var(--accent-red);"></i> 2ê°œì›” ì´ë‚´ (${twoMonths.length}ê°œì†Œ)</div>`;
                twoMonths.forEach(o => {
                    html += `<div class="alert-item critical" onclick="highlightAndShowDetails('${o.id}')" title="${o.ì§€ì ëª…} ìƒì„¸ ë³´ê¸°" style="cursor:pointer;">
                                <i class="fas fa-building"></i> ${o.ì§€ì ëª…} (${o.ë‚¨ì€ì¼ìˆ˜}ì¼)
                            </div>`;
                });
            }
            if (sixMonths.length > 0) {
                html += `<div class="alert-period" style="margin-top: 10px;"><i class="fas fa-hourglass-half" style="color: var(--accent-yellow);"></i> 6ê°œì›” ì´ë‚´ (${sixMonths.length}ê°œì†Œ)</div>`;
                sixMonths.forEach(o => {
                    html += `<div class="alert-item warning" onclick="highlightAndShowDetails('${o.id}')" title="${o.ì§€ì ëª…} ìƒì„¸ ë³´ê¸°" style="cursor:pointer;">
                                <i class="fas fa-building"></i> ${o.ì§€ì ëª…} (${o.ë‚¨ì€ì¼ìˆ˜}ì¼)
                            </div>`;
                });
            }
            wrapper.innerHTML = html;
        }
        
        function highlightAndShowDetails(officeId) {
            if (switchPage.currentPage !== 'overview') switchPage('overview', document.querySelector('.nav-item[onclick*="overview"]'));
            
            setTimeout(() => { 
                const targetOffice = allOfficeData.find(o => o.id === officeId);
                if(!targetOffice) return;

                document.getElementById('searchInput').value = targetOffice.ì§€ì ëª…;
                document.getElementById('statusFilter').value = 'ì‚¬ìš©ì¤‘';
                document.getElementById('usageFilter').value = targetOffice.ì‚¬ìš©ì²˜ || 'ì „ì²´'; // Highlight related filters
                document.getElementById('regionFilter').value = targetOffice.ì§€ì—­ || 'ì „ì²´'; // Highlight related filters
                document.getElementById('expiryFilter').value = 'all';
                applyAllFilters();

                setTimeout(() => {
                    const rowElement = document.getElementById(`row-${officeId}`);
                    if (rowElement) {
                        rowElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        if (expandedOfficeId && expandedOfficeId !== officeId) toggleOfficeDetails(expandedOfficeId);
                        if (expandedOfficeId !== officeId || !document.getElementById(`dropdown-${officeId}`).classList.contains('show')) {
                             toggleOfficeDetails(officeId);
                        }
                        rowElement.style.transition = 'background-color 0.3s ease, transform 0.3s ease';
                        rowElement.style.transform = 'scale(1.01)';
                        setTimeout(() => { rowElement.style.transform = 'scale(1)'; }, 2000);
                    }
                }, 200); 
            }, 50);
        }

        function showMessageOnTable(msg) {
            const container = document.getElementById('officesTableContainer');
            if(container) container.innerHTML = `<div class="loading">${msg}</div>`;
        }

        function toggleOfficeDetails(id) {
            const office = allOfficeData.find(o => o.id === id);
            if (!office) return;
            const row = document.getElementById(`row-${id}`);
            const detailRow = document.getElementById(`detail-${id}`);
            const dropdown = document.getElementById(`dropdown-${id}`);
            if (!row || !detailRow || !dropdown) return;

            if (expandedOfficeId && expandedOfficeId !== id) {
                const prevRow = document.getElementById(`row-${expandedOfficeId}`);
                const prevDetail = document.getElementById(`detail-${expandedOfficeId}`);
                const prevDropdown = document.getElementById(`dropdown-${expandedOfficeId}`);
                if (prevRow && prevDetail && prevDropdown) {
                    prevRow.classList.remove('expanded'); prevDetail.style.display = 'none';
                    prevDropdown.classList.remove('show'); prevDropdown.innerHTML = '';
                }
            }
            if (expandedOfficeId === id) {
                row.classList.remove('expanded'); detailRow.style.display = 'none';
                dropdown.classList.remove('show'); dropdown.innerHTML = '';
                expandedOfficeId = null;
            } else {
                row.classList.add('expanded'); detailRow.style.display = 'table-row';
                dropdown.innerHTML = generateOfficeDetails(office);
                setTimeout(() => dropdown.classList.add('show'), 10);
                expandedOfficeId = id;
            }
        }

        function generateOfficeDetails(o) { 
            let html = '<div class="detail-grid">';
            html += '<div class="detail-section"><h4><i class="fas fa-info-circle"></i> ê¸°ë³¸ ì •ë³´</h4>';
            if (o.ì£¼ì†Œ) html += `<div class="detail-item"><strong>ì£¼ì†Œ:</strong><span>${o.ì£¼ì†Œ}</span></div>`;
            // Display ì‚¬ìš©ì²˜ and ì§€ì—­ in details as well
            if (o.ì‚¬ìš©ì²˜) html += `<div class="detail-item"><strong>ì‚¬ìš©ì²˜:</strong><span>${o.ì‚¬ìš©ì²˜}</span></div>`;
            if (o.ì§€ì—­) html += `<div class="detail-item"><strong>ì§€ì—­:</strong><span>${o.ì§€ì—­}</span></div>`;
            let areaPyeongText = '';
            if (o.ë©´ì  && o.í‰í˜•) areaPyeongText = `${o.ë©´ì } mÂ² / ${o.í‰í˜•.toFixed(1)}í‰`;
            else if (o.ë©´ì ) areaPyeongText = `${o.ë©´ì } mÂ²`;
            else if (o.í‰í˜•) areaPyeongText = `${o.í‰í˜•.toFixed(1)}í‰`;
            if(areaPyeongText) html += `<div class="detail-item"><strong>ë©´ì /í‰í˜•:</strong><span>${areaPyeongText}</span></div>`;
            if (o.ì„ëŒ€ì¸) html += `<div class="detail-item"><strong>ì„ëŒ€ì¸:</strong><span>${o.ì„ëŒ€ì¸}</span></div>`;
            if (o.ì—°ë½ì²˜) {
                const digits = String(o.ì—°ë½ì²˜).replace(/\D/g, '');
                const phoneDisplay = digits ? `<a href="tel:${digits}" style="color: var(--sidebar-accent); text-decoration:none; font-weight:600;">${o.ì—°ë½ì²˜}</a>` : o.ì—°ë½ì²˜;
                html += `<div class="detail-item"><strong>ì—°ë½ì²˜:</strong><span>${phoneDisplay}</span></div>`;
            }
            html += '</div>';
            html += '<div class="detail-section"><h4><i class="fas fa-file-contract"></i> ê³„ì•½ ì •ë³´</h4>';
            if (o.ê³„ì•½ì¼) html += `<div class="detail-item"><strong>ê³„ì•½ì¼:</strong><span>${o.ê³„ì•½ì¼}</span></div>`;
            if (o.ë§Œë£Œì¼) html += `<div class="detail-item"><strong>ë§Œë£Œì¼:</strong><span>${o.ë§Œë£Œì¼}</span></div>`;
            if (o.ë‚¨ì€ì¼ìˆ˜ !== null && !isNaN(o.ë‚¨ì€ì¼ìˆ˜)) {
                let daysColor = 'var(--text-secondary)';
                if (o.í˜„í™© === 'ì‚¬ìš©ì¤‘') {
                    if (o.ë‚¨ì€ì¼ìˆ˜ < 0) daysColor = 'var(--accent-red)'; else if (o.ë‚¨ì€ì¼ìˆ˜ <= 60) daysColor = 'var(--accent-red)';
                    else if (o.ë‚¨ì€ì¼ìˆ˜ <= 180) daysColor = 'var(--accent-yellow)'; else daysColor = 'var(--accent-green)';
                }
                const daysText = o.ë‚¨ì€ì¼ìˆ˜ < 0 ? `ë§Œë£Œ ${Math.abs(o.ë‚¨ì€ì¼ìˆ˜)}ì¼ ì§€ë‚¨` : (o.ë‚¨ì€ì¼ìˆ˜ === 0 ? 'ì˜¤ëŠ˜ë§Œë£Œ' : `${o.ë‚¨ì€ì¼ìˆ˜}ì¼`);
                html += `<div class="detail-item"><strong style="color: ${daysColor};">ë‚¨ì€ ê¸°ê°„:</strong><span style="color: ${daysColor}; font-weight:600;">${daysText}</span></div>`;
            }
            if (o.ë³´ì¦ê¸ˆ) html += `<div class="detail-item"><strong>ë³´ì¦ê¸ˆ:</strong><span>${o.ë³´ì¦ê¸ˆ} ì›</span></div>`;
            if (o.ì›”ì„¸) html += `<div class="detail-item"><strong>ì›”ì„¸:</strong><span>${o.ì›”ì„¸} ì›</span></div>`;
            html += '</div></div>';
            if (o.ë¹„ê³ ) { 
                html += `<div class="detail-full-width" style="margin-top:15px;"><div class="detail-item"><strong><i class="fas fa-sticky-note"></i> ë¹„ê³ :</strong><span style="white-space:pre-wrap;">${o.ë¹„ê³ }</span></div></div>`;
            }
            return html;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í˜ì´ì§€ ë° ëª¨ë“œ ê´€ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function updatePageTitleAndBreadcrumb(page) {
            const cfg = {
                'overview': { title: 'ì‚¬ë¬´ì‹¤ ì„ëŒ€ í˜„í™©', breadcrumb: 'í™ˆ > ì‚¬ë¬´ì‹¤ í˜„í™©' },
                'stats':    { title: 'í˜„í™© í†µê³„',       breadcrumb: 'í™ˆ > í†µê³„' }
            }[page] || { title: 'CFC í˜„í™©íŒ', breadcrumb: 'í™ˆ' };
            document.getElementById('pageTitle').textContent = cfg.title;
            document.getElementById('pageBreadcrumb').textContent = cfg.breadcrumb;
        }

        function switchPage(page, clickedElement) {
            switchPage.currentPage = page; 
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (clickedElement) clickedElement.classList.add('active');
            updatePageTitleAndBreadcrumb(page);

            const tableContainer = document.getElementById('officesTableContainer');
            const filtersContainer = document.querySelector('.filters-container');
            const statsSection = document.getElementById('statsSection');
            const filterSummaryCard = document.getElementById('filterSummaryCard');

            if (expandedOfficeId) toggleOfficeDetails(expandedOfficeId); 

            if (page === 'overview') {
                filtersContainer.style.display = 'grid'; statsSection.style.display = 'none';
                tableContainer.style.display = ''; 
                if (allOfficeData.length > 0 ) applyAllFilters();
                else if (!connectionData.length) connectAppsScript();
                else showSkeletonTable(); 
            } else if (page === 'stats') {
                filtersContainer.style.display = 'none'; statsSection.style.display = 'block';
                tableContainer.style.display = 'none'; filterSummaryCard.style.display = 'none';
                showStats();
            }
            if (document.getElementById('sidebar').classList.contains('mobile-active')) toggleMobileMenu();
        }
        switchPage.currentPage = 'overview'; 

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í†µê³„ í˜ì´ì§€ ë¡œì§ (ìˆ˜ì •ë¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function showStats() {
            if (allOfficeData.length === 0 && connectionData.length > 0) {
                parseAndRenderOfficeData(connectionData);
            }
            if (allOfficeData.length === 0) {
                showToast('í†µê³„ í‘œì‹œì— í•„ìš”í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning'); 
                // ëª¨ë“  í†µê³„ í•„ë“œë¥¼ '0' ë˜ëŠ” '-'ë¡œ ì´ˆê¸°í™”
                ['metricActiveOffices', 'metricTotalRent', 'metricTotalDeposit', 'metricAvgRent'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = id.includes('Offices') ? '0 ê°œì†Œ' : '0 ì›';
                });
                document.getElementById('regionStats').innerHTML = '<p>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                document.getElementById('usageStats').innerHTML = '<p>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const activeData = allOfficeData.filter(o => o.í˜„í™© === 'ì‚¬ìš©ì¤‘');
            const activeCount = activeData.length;
            const totalRent = activeData.reduce((sum, o) => sum + (parseFloat(String(o.ì›”ì„¸_ì›ë³¸ || '0').replace(/,/g, '')) || 0), 0);
            const totalDeposit = activeData.reduce((sum, o) => sum + (parseFloat(String(o.ë³´ì¦ê¸ˆ_ì›ë³¸ || '0').replace(/,/g, '')) || 0), 0);
            const avgRent = activeCount > 0 ? totalRent / activeCount : 0;

            // 1. ì£¼ìš” ì§€í‘œ ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('metricActiveOffices').textContent = `${activeCount} ê°œì†Œ`;
            document.getElementById('metricTotalRent').textContent = `${totalRent.toLocaleString()} ì›`;
            document.getElementById('metricTotalDeposit').textContent = `${totalDeposit.toLocaleString()} ì›`;
            document.getElementById('metricAvgRent').textContent = `${Math.round(avgRent).toLocaleString()} ì›`;
            
            // 2. ìƒì„¸ ë¶„ì„ í…Œì´ë¸” ìƒì„±
            const regionStatsData = generateGroupedStats(activeData, 'ì§€ì—­');
            renderStatsTable(regionStatsData, 'regionStats', 'ì§€ì—­', ['ì§€ì—­', 'ì‚¬ë¬´ì‹¤ ìˆ˜', 'ì›”ì„¸ ì´ì•¡', 'ë³´ì¦ê¸ˆ ì´ì•¡', 'í‰ê·  ì›”ì„¸']);
            
            const usageStatsData = generateGroupedStats(activeData, 'ì‚¬ìš©ì²˜');
            renderStatsTable(usageStatsData, 'usageStats', 'ì‚¬ìš©ì²˜', ['ì‚¬ìš©ì²˜', 'ì‚¬ë¬´ì‹¤ ìˆ˜', 'ì›”ì„¸ ì´ì•¡', 'ë³´ì¦ê¸ˆ ì´ì•¡', 'í‰ê·  ì›”ì„¸']);

            // 3. ê¸°ë³¸ìœ¼ë¡œ ì²«ë²ˆì§¸ íƒ­ í™œì„±í™”
            openStatTab(null, 'regionStats');
            const firstTab = document.querySelector('.tab-link');
            if(firstTab) firstTab.classList.add('active');
        }
        
        function generateGroupedStats(data, groupKey) {
            const groups = data.reduce((acc, office) => {
                const key = String(office[groupKey] || 'ë¯¸ì§€ì •').trim();
                if (!acc[key]) {
                    acc[key] = { count: 0, totalRent: 0, totalDeposit: 0 };
                }
                acc[key].count++;
                acc[key].totalRent += parseFloat(String(office.ì›”ì„¸_ì›ë³¸ || '0').replace(/,/g, '')) || 0;
                acc[key].totalDeposit += parseFloat(String(office.ë³´ì¦ê¸ˆ_ì›ë³¸ || '0').replace(/,/g, '')) || 0;
                return acc;
            }, {});

            return Object.entries(groups).map(([key, value]) => ({
                groupName: key,
                count: value.count,
                totalRent: value.totalRent,
                totalDeposit: value.totalDeposit,
                avgRent: value.count > 0 ? value.totalRent / value.count : 0
            })).sort((a, b) => b.totalRent - a.totalRent); // ì›”ì„¸ ì´ì•¡ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
        }
        
        function renderStatsTable(data, containerId, groupKey, headers) {
            const container = document.getElementById(containerId);
            if (!container) return;

            if (data.length === 0) {
                container.innerHTML = '<p>í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            let tableHtml = '<table class="stats-detail-table"><thead><tr>';
            headers.forEach(header => tableHtml += `<th>${header}</th>`);
            tableHtml += '</tr></thead><tbody>';

            data.forEach(item => {
                tableHtml += `<tr class="stats-summary-row" onclick="toggleGroupDetails(this, '${groupKey}', '${item.groupName.replace(/'/g, "\\'")}')">
                        <td>${item.groupName}</td>
                        <td>${item.count.toLocaleString()} ê°œ</td>
                        <td>${item.totalRent.toLocaleString()} ì›</td>
                        <td>${item.totalDeposit.toLocaleString()} ì›</td>
                        <td>${Math.round(item.avgRent).toLocaleString()} ì›</td>
                    </tr>
                    <tr class="stats-detail-row">
                        <td colspan="${headers.length}" class="stats-detail-content"></td>
                    </tr>
                `;
            });

            tableHtml += '</tbody></table>';
            container.innerHTML = tableHtml;
        }

        function toggleGroupDetails(rowElement, groupKey, groupName) {
            const detailRow = rowElement.nextElementSibling;
            const detailContent = detailRow.querySelector('.stats-detail-content');

            // ì´ë¯¸ ì—´ë ¤ìˆëŠ” í–‰ì„ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ë‹«ê¸°
            if (rowElement.classList.contains('expanded')) {
                rowElement.classList.remove('expanded');
                detailRow.style.display = 'none';
                detailContent.innerHTML = '';
                expandedStatRow = null;
                return;
            }

            // ë‹¤ë¥¸ í–‰ì´ ì—´ë ¤ìˆìœ¼ë©´ ë¨¼ì € ë‹«ê¸°
            if (expandedStatRow) {
                expandedStatRow.classList.remove('expanded');
                const prevDetailRow = expandedStatRow.nextElementSibling;
                prevDetailRow.style.display = 'none';
                prevDetailRow.querySelector('.stats-detail-content').innerHTML = '';
            }

            // ìƒì„¸ ì •ë³´ ìƒì„± ë° í‘œì‹œ
            const officesInGroup = allOfficeData.filter(o => o.í˜„í™© === 'ì‚¬ìš©ì¤‘' && o[groupKey] === groupName);
            
            let subTableHtml = '<table class="stats-sub-table">';
            if (groupKey === 'ì§€ì—­') {
                subTableHtml += '<thead><tr><th>ì‚¬ìš©ì²˜</th><th>ì§€ì ëª… / ì£¼ì†Œ</th><th>ë³´ì¦ê¸ˆ</th><th>ì›”ì„¸</th></tr></thead><tbody>';
                officesInGroup.forEach(o => {
                    subTableHtml += `<tr>
                        <td>${o.ì‚¬ìš©ì²˜ || '-'}</td>
                        <td>${o.ì§€ì ëª…}<br><small style="color:var(--text-secondary);">${o.ì£¼ì†Œ || ''}</small></td>
                        <td>${o.ë³´ì¦ê¸ˆ} ì›</td>
                        <td>${o.ì›”ì„¸} ì›</td>
                    </tr>`;
                });
            } else { // groupKey === 'ì‚¬ìš©ì²˜'
                subTableHtml += '<thead><tr><th>ì§€ì—­</th><th>ì§€ì ëª… / ì£¼ì†Œ</th><th>ë³´ì¦ê¸ˆ</th><th>ì›”ì„¸</th></tr></thead><tbody>';
                officesInGroup.forEach(o => {
                    subTableHtml += `<tr>
                        <td>${o.ì§€ì—­ || '-'}</td>
                        <td>${o.ì§€ì ëª…}<br><small style="color:var(--text-secondary);">${o.ì£¼ì†Œ || ''}</small></td>
                        <td>${o.ë³´ì¦ê¸ˆ} ì›</td>
                        <td>${o.ì›”ì„¸} ì›</td>
                    </tr>`;
                });
            }
            subTableHtml += '</tbody></table>';

            detailContent.innerHTML = subTableHtml;
            rowElement.classList.add('expanded');
            detailRow.style.display = 'table-row';
            expandedStatRow = rowElement; // í˜„ì¬ ì—´ë¦° í–‰ìœ¼ë¡œ ì„¤ì •
        }

        function openStatTab(evt, tabName) {
            const tabcontent = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            const tablinks = document.getElementsByClassName("tab-link");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            document.getElementById(tabName).style.display = "block";
            if (evt) {
                evt.currentTarget.className += " active";
            }
            expandedStatRow = null; // íƒ­ ì „í™˜ ì‹œ ì—´ë ¤ìˆëŠ” ìƒì„¸ ì •ë³´ ì´ˆê¸°í™”
        }


        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í…Œì´ë¸” ì •ë ¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function sortTable(column) {
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : (currentSortDirection === 'desc' ? '' : 'asc');
            } else {
                currentSortColumn = column; currentSortDirection = 'asc';
            }
            applyAllFilters(); 
            
            const directionText = currentSortDirection === 'asc' ? 'ì˜¤ë¦„ì°¨ìˆœ' : (currentSortDirection === 'desc' ? 'ë‚´ë¦¼ì°¨ìˆœ' : 'ê¸°ë³¸');
            if(currentSortDirection !== '') showToast(`${column} ê¸°ì¤€ ${directionText} ì •ë ¬ ì™„ë£Œ`, 'info', 1500);
            else showToast(`${column} ê¸°ì¤€ ì •ë ¬ í•´ì œ`, 'info', 1500);
        }
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìë™ì™„ì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function setupAutocompleteData() {
            autocompleteData = [];
            if (allOfficeData && allOfficeData.length > 0) {
                allOfficeData.forEach(office => {
                    if (office.ì§€ì ëª…) autocompleteData.push(String(office.ì§€ì ëª…));
                    if (office.ì£¼ì†Œ) autocompleteData.push(String(office.ì£¼ì†Œ));
                    if (office.ì‚¬ìš©ì²˜) autocompleteData.push(String(office.ì‚¬ìš©ì²˜)); // Add ì‚¬ìš©ì²˜ to autocomplete
                    if (office.ì§€ì—­) autocompleteData.push(String(office.ì§€ì—­));   // Add ì§€ì—­ to autocomplete
                });
                autocompleteData = [...new Set(autocompleteData.filter(item => item.trim() !== ''))].sort((a,b) => a.localeCompare(b, 'ko'));
            }
        }
        
        function handleAutocomplete(query) {
            const dropdown = document.getElementById('autocompleteDropdown');
            const trimmedQuery = query.trim();
            if (!trimmedQuery) { hideAutocomplete(); return; }

            const lowercasedQuery = trimmedQuery.toLowerCase();
            const matches = autocompleteData
                .filter(item => item.toLowerCase().includes(lowercasedQuery))
                .slice(0, 8); 
            if (matches.length === 0) { hideAutocomplete(); return; }
            
            const escapedQueryForRegex = escapeRegExp(trimmedQuery);
            let html = '';
            matches.forEach((item, index) => {
                const highlightedItem = item.replace(new RegExp(escapedQueryForRegex, 'gi'), match => `<span class="match">${match}</span>`);
                html += `<div class="autocomplete-item" data-index="${index}" onmousedown="selectAutocomplete('${item.replace(/'/g, "\\'")}')">${highlightedItem}</div>`;
            });
            dropdown.innerHTML = html; dropdown.style.display = 'block'; selectedAutocompleteIndex = -1;
        }

        function handleAutocompleteKeydown(e) {
            const dropdown = document.getElementById('autocompleteDropdown');
            if (dropdown.style.display === 'none' && (e.key === 'ArrowDown' || e.key === 'ArrowUp')) {
                handleAutocomplete(e.target.value);
                if(document.getElementById('autocompleteDropdown').querySelectorAll('.autocomplete-item').length > 0) e.preventDefault();
                return;
            }
            const items = dropdown.querySelectorAll('.autocomplete-item');
            if (items.length === 0) return;

            if (e.key === 'ArrowDown') {
                e.preventDefault(); selectedAutocompleteIndex = (selectedAutocompleteIndex + 1) % items.length;
                updateAutocompleteSelection(items);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault(); selectedAutocompleteIndex = (selectedAutocompleteIndex - 1 + items.length) % items.length;
                updateAutocompleteSelection(items);
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (selectedAutocompleteIndex >= 0 && selectedAutocompleteIndex < items.length) {
                    selectAutocomplete(items[selectedAutocompleteIndex].textContent.trim());
                } else { hideAutocomplete(); }
            } else if (e.key === 'Escape') { hideAutocomplete(); }
        }

        function updateAutocompleteSelection(items) {
            items.forEach((item, index) => {
                item.classList.toggle('selected', index === selectedAutocompleteIndex);
                if (index === selectedAutocompleteIndex) item.scrollIntoView({ block: 'nearest', inline: 'nearest' });
            });
        }

        function selectAutocomplete(value) {
            document.getElementById('searchInput').value = value;
            hideAutocomplete();
            applyAllFilters(); 
        }

        function hideAutocomplete() {
            const dropdown = document.getElementById('autocompleteDropdown');
            if (dropdown) { dropdown.style.display = 'none'; dropdown.innerHTML = ''; }
            selectedAutocompleteIndex = -1;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì»¬ëŸ¼ í† ê¸€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function toggleColumnDropdown() {
            const dropdown = document.getElementById('columnToggleDropdown');
            if (dropdown) dropdown.style.display = window.getComputedStyle(dropdown).display === 'block' ? 'none' : 'block';
        }

        function setupColumnToggles() {
            const checkboxesInfo = [
                { id: 'col-í˜„í™©', key: 'í˜„í™©' }, { id: 'col-ì§€ì ëª…', key: 'ì§€ì ëª…' },
                { id: 'col-ì‚¬ìš©ì²˜', key: 'ì‚¬ìš©ì²˜' }, { id: 'col-ì§€ì—­', key: 'ì§€ì—­' },
                { id: 'col-ê³„ì•½ì¼', key: 'ê³„ì•½ì¼' }, { id: 'col-ë§Œë£Œì¼', key: 'ë§Œë£Œì¼' },
                { id: 'col-ë‚¨ì€ê¸°ê°„', key: 'ë‚¨ì€ê¸°ê°„' }, { id: 'col-ë³´ì¦ê¸ˆ', key: 'ë³´ì¦ê¸ˆ' },
                { id: 'col-ì›”ì„¸', key: 'ì›”ì„¸' } 
            ];
            checkboxesInfo.forEach(({ id, key }) => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    checkbox.checked = visibleColumns[key];
                    checkbox.addEventListener('change', (e) => handleColumnToggle(e, key));
                }
            });
        }

        function handleColumnToggle(event, columnKey) {
            visibleColumns[columnKey] = event.target.checked;
            if (Object.values(visibleColumns).filter(Boolean).length === 0) {
                event.target.checked = true; visibleColumns[columnKey] = true;
                showToast('ìµœì†Œ 1ê°œ ì»¬ëŸ¼ì€ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤', 'warning', 2000);
            }
            if (expandedOfficeId) toggleOfficeDetails(expandedOfficeId);
            applyAllFilters(); 
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë°ì´í„° ìš”ì•½ ì¹´ë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function updateFilterSummary(data) {
            const card = document.getElementById('filterSummaryCard');
            const isFiltered = document.getElementById('searchInput').value.trim() || 
                               document.getElementById('statusFilter').value !== 'ì „ì²´' || 
                               document.getElementById('usageFilter').value !== 'ì „ì²´' ||   // New
                               document.getElementById('regionFilter').value !== 'ì „ì²´' ||  // New
                               document.getElementById('expiryFilter').value !== 'all';

            if (document.getElementById('statsSection').style.display === 'none') {
                if (isFiltered) {
                    card.classList.add('show');
                    const activeData = data.filter(o => o.í˜„í™© === 'ì‚¬ìš©ì¤‘');
                    document.getElementById('summaryTotal').textContent = data.length;
                    document.getElementById('summaryActive').textContent = activeData.length;
                    document.getElementById('summaryExpiring').textContent = activeData.filter(o => o.ë‚¨ì€ì¼ìˆ˜ !== null && o.ë‚¨ì€ì¼ìˆ˜ >= 0 && o.ë‚¨ì€ì¼ìˆ˜ <= 180).length;
                    document.getElementById('summaryTotalRent').textContent = activeData.reduce((sum, o) => sum + (parseFloat(String(o.ì›”ì„¸_ì›ë³¸ || '0').replace(/,/g, '')) || 0), 0).toLocaleString() + 'ì›';
                } else { card.classList.remove('show'); }
            } else { card.classList.remove('show'); }
        }
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í† ìŠ¤íŠ¸ ì•Œë¦¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icons = { success: 'fa-check-circle', info: 'fa-info-circle', warning: 'fa-exclamation-triangle', error: 'fa-times-circle' };
            toast.innerHTML = `<i class="fas ${icons[type] || 'fa-info-circle'} toast-icon"></i><span class="toast-message">${message}</span><button class="toast-close" onclick="this.parentElement.style.animation = 'slideOut 0.3s ease-out forwards'; setTimeout(() => { if(this.parentElement) this.parentElement.remove(); }, 300);">&times;</button>`;
            container.appendChild(toast);
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.animation = 'slideOut 0.3s ease-out forwards';
                    setTimeout(() => { if (toast.parentElement) toast.remove(); }, 300);
                }
            }, duration);
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í…Œë§ˆ ê´€ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function toggleTheme() {
            isDarkMode = !isDarkMode; document.body.classList.toggle('dark-mode', isDarkMode);
            const themeIcon = document.getElementById('themeIcon'); const themeText = document.getElementById('themeText');
            if (isDarkMode) { themeIcon.className = 'fas fa-sun'; themeText.textContent = 'ë¼ì´íŠ¸ëª¨ë“œ'; }
            else { themeIcon.className = 'fas fa-moon'; themeText.textContent = 'ë‹¤í¬ëª¨ë“œ'; }
            localStorage.setItem('cfc-theme', isDarkMode ? 'dark' : 'light');
            showToast(isDarkMode ? 'ë‹¤í¬ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤' : 'ë¼ì´íŠ¸ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'info', 1500);
        }
        function loadThemeFromStorage() {
            isDarkMode = (localStorage.getItem('cfc-theme') === 'dark');
            document.body.classList.toggle('dark-mode', isDarkMode);
            const themeIcon = document.getElementById('themeIcon'); const themeText = document.getElementById('themeText');
            if (isDarkMode) { themeIcon.className = 'fas fa-sun'; themeText.textContent = 'ë¼ì´íŠ¸ëª¨ë“œ'; }
            else { themeIcon.className = 'fas fa-moon'; themeText.textContent = 'ë‹¤í¬ëª¨ë“œ'; }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function escapeRegExp(string) { return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

        function parseDateValue(val) {
            if (val === null || val === undefined || String(val).trim() === '') return new Date(NaN);
            
            const s = String(val).trim();
            
            const parts = s.match(/(\d{4})[^\d]*(\d{1,2})[^\d]*(\d{1,2})/);
            if (parts) {
                const year = parseInt(parts[1], 10);
                const month = parseInt(parts[2], 10) - 1; 
                const day = parseInt(parts[3], 10);
                const date = new Date(year, month, day);
                
                if (date.getFullYear() === year && date.getMonth() === month && date.getDate() === day) {
                    return date;
                }
            }
            
            const standardDate = new Date(s);
            if (!isNaN(standardDate.getTime())) {
                return standardDate;
            }
            
            const numVal = parseFloat(s);
            if (!isNaN(numVal) && numVal > 0 && numVal < 2958466) {
                const excelEpoch = new Date(1899, 11, 30);
                const dateMillis = excelEpoch.getTime() + numVal * 24 * 60 * 60 * 1000;
                return new Date(dateMillis);
            }
            
            return new Date(NaN);
        }

        function formatDate(v) {
            if (v === null || v === undefined || String(v).trim() === '') return '';
            const d = parseDateValue(v);
            if (isNaN(d.getTime())) return ''; 
            const yyyy = d.getFullYear();
            const mm = String(d.getMonth() + 1).padStart(2, '0');
            const dd = String(d.getDate()).padStart(2, '0');
            return `${yyyy}-${mm}-${dd}`;
        }

        function formatNumber(n) {
            if (n === null || n === undefined || String(n).trim() === '') return '';
            const num = parseFloat(String(n).replace(/[^0-9.-]/g, ''));
            if (isNaN(num)) return ''; 
            return num.toLocaleString('ko-KR');
        }
        
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const isActive = sidebar.classList.toggle('mobile-active');
            if(overlay) overlay.classList.toggle('active', isActive);
        }
    </script>
    <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js', { scope: './' })
        .then(registration => {
          console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì ìš© ë²”ìœ„:', registration.scope);
        })
        .catch(error => {
          console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ì— ìµœì¢… ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
        });
    });
  }
</script>
</body>
</html>
